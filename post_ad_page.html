<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post Your Vehicle Ad | AutoTrader.lk</title>
    <style>
    /* Global Styles */
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: #f8f9fa;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
    }
    
    /* Header */
    .header {
        background: #1e3a8a;
        color: white;
        padding: 1rem 0;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .header-content {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0 20px;
    }
    
    .logo {
        font-size: 2rem;
        font-weight: bold;
        text-decoration: none;
        color: white;
    }
    
    .nav-menu {
        display: flex;
        list-style: none;
        gap: 30px;
    }
    
    .nav-menu a {
        color: white;
        text-decoration: none;
        font-weight: 500;
        transition: color 0.3s;
    }
    
    .nav-menu a:hover {
        color: #fbbf24;
    }
    
    .icon-btn {
        background: transparent;
        color: white;
        text-decoration: none;
        font-size: 1.2rem;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 40px;
        height: 40px;
    }

    .icon-btn:hover {
        background: none;
        color: #fbbf24;
        transform: scale(1.1);
    }
    
    .user-actions {
        display: flex;
        gap: 15px;
        align-items: center;
    }
    
    .btn-primary {
        background: #fbbf24;
        color: #1e3a8a;
        border: none;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: bold;
        text-decoration: none;
        transition: background 0.3s;
    }
    
    .btn-primary:hover {
        background: #f59e0b;
    }
    
    /* Breadcrumb */
    .breadcrumb {
        background: #e5e7eb;
        padding: 10px 0;
    }
    
    .breadcrumb-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        font-size: 0.9rem;
    }
    
    .breadcrumb a {
        color: #6b7280;
        text-decoration: none;
    }
    
    .breadcrumb a:hover {
        color: #1e3a8a;
    }
    
    /* Main Container */
    .main-container {
        max-width: 1200px;
        margin: 20px auto;
        padding: 0 20px;
        display: grid;
        grid-template-columns: 1fr 300px;
        gap: 30px;
        flex: 1;
        width: 100%;
        align-items: start;
    }
    
    .container {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
    }
    
    /* Page Header */
    .page-header {
        grid-column: 1 / -1;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        margin-bottom: 20px;
        text-align: center;
    }
    
    .page-title {
        font-size: 2.5rem;
        color: #1f2937;
        margin-bottom: 10px;
    }
    
    .page-subtitle {
        font-size: 1.1rem;
        color: #6b7280;
        margin-bottom: 20px;
    }
    
    /* Progress Steps */
    .progress-steps {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 20px;
        margin-top: 25px;
    }
    
    .step {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 20px;
        font-size: 0.9rem;
        transition: all 0.3s;
        position: relative;
    }
    
    .step.active {
        background: #1e3a8a;
        color: white;
        animation: pulseActive 2s ease-in-out infinite;
    }
    
    .step.completed {
        background: #10b981;
        color: white;
        transform: scale(1.05);
    }
    
    .step.completed::after {
        content: '✓';
        position: absolute;
        right: 8px;
        top: 50%;
        transform: translateY(-50%);
        font-weight: bold;
        font-size: 0.8rem;
    }
    
    .step.inactive {
        background: #e5e7eb;
        color: #6b7280;
    }
    
    .step-number {
        background: rgba(255,255,255,0.2);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.8rem;
    }
    
    .step.inactive .step-number {
        background: #9ca3af;
        color: white;
    }
    
    @keyframes pulseActive {
        0%, 100% { box-shadow: 0 0 0 0 rgba(30, 58, 138, 0.4); }
        50% { box-shadow: 0 0 0 8px rgba(30, 58, 138, 0); }
    }
    
    /* Form Container */
    .form-container {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        overflow: hidden;
    }
    
    .form-section {
        padding: 25px;
        border-bottom: 1px solid #e5e7eb;
    }
    
    .form-section:last-child {
        border-bottom: none;
    }
    
    /* Section Titles */
    .section-title {
        font-size: 1.8rem;
        color: #1f2937;
        margin-bottom: 12px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .section-icon {
        width: 32px;
        height: 32px;
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1.2rem;
    }
    
    .section-subtitle {
        color: #6b7280;
        margin-bottom: 32px;
        font-size: 1.05rem;
    }
    
    /* Form Grid */
    .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }
    
    .form-group {
        display: flex;
        flex-direction: column;
    }
    
    .form-group.full-width {
        grid-column: 1 / -1;
    }
    
    .form-label {
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 5px;
    }
    
    .required {
        color: #ef4444;
    }
    
    /* Form Inputs */
    .form-input,
    .form-select,
    .form-textarea {
        padding: 12px;
        border: 2px solid #d1d5db;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s;
        background: white;
    }
    
    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
        outline: none;
        border-color: #1e3a8a;
        box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
    }
    
    .form-textarea {
        resize: vertical;
        min-height: 120px;
    }
    
    .input-hint {
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: 5px;
        font-style: italic;
    }
    
    /* Enhanced Vehicle Types Grid */
    .vehicle-types {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 16px;
        margin-bottom: 20px;
    }
    
    .vehicle-type {
        background: #ffffff;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 20px 16px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        height: 120px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    
    .vehicle-type::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(30, 58, 138, 0.1), transparent);
        transition: left 0.5s;
    }
    
    .vehicle-type:hover::before {
        left: 100%;
    }
    
    .vehicle-type:hover {
        border-color: #1e3a8a;
        background: #f0f9ff;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(30, 58, 138, 0.15);
    }
    
    .vehicle-type.selected {
        border-color: #1e3a8a;
        background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
        color: white;
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(30, 58, 138, 0.3);
    }
    
    .vehicle-type.selected .vehicle-type-icon {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }
    
    .vehicle-type.selected .vehicle-type-name {
        color: white;
        font-weight: 600;
    }
    
    /* Vehicle Type Icons */
    .vehicle-type-icon {
        width: 48px;
        height: 48px;
        background: #f3f4f6;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        margin-bottom: 4px;
        font-size: 1.5rem;
    }
    
    .vehicle-type-icon svg {
        width: 28px;
        height: 28px;
        stroke: #1e3a8a;
        fill: none;
        transition: all 0.3s ease;
    }
    
    .vehicle-type:hover .vehicle-type-icon svg {
        stroke: #1e3a8a;
        fill: none;
        transform: scale(1.1);
    }
    
    .vehicle-type-icon svg circle[fill="currentColor"] {
        fill: #1e3a8a;
    }
    
    .vehicle-type:hover .vehicle-type-icon svg circle[fill="currentColor"] {
        fill: #1e3a8a;
    }
    
    .vehicle-type.selected .vehicle-type-icon svg circle[fill="currentColor"] {
        fill: white;
    }
    
    .vehicle-type.selected .vehicle-type-icon svg {
        stroke: #FFFFFF;
        fill: none;
    }
    
    .vehicle-type.selected .vehicle-type-icon svg[fill="#000000"] {
        fill: #FFFFFF;
    }
    
    .vehicle-type-name {
        font-weight: 500;
        color: #374151;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        text-align: center;
        line-height: 1.3;
    }
    
    /* Selected state indicator */
    .vehicle-type.selected::after {
        content: '✓';
        position: absolute;
        top: 8px;
        right: 8px;
        width: 20px;
        height: 20px;
        background: #fbbf24;
        color: #1e3a8a;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 0.8rem;
        font-weight: bold;
    }
    
    /* Special styling for finance tab */
    .vehicle-type.finance-type {
        background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        color: white;
        border-color: #f59e0b;
    }

    .vehicle-type.finance-type:hover {
        background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
        border-color: #d97706;
    }

    .vehicle-type.finance-type.selected {
        background: linear-gradient(135deg, #d97706 0%, #f59e0b 100%);
        border-color: #92400e;
    }

    .vehicle-type.finance-type .vehicle-type-icon {
        background: rgba(255, 255, 255, 0.2);
        color: white;
    }

    .vehicle-type.finance-type .vehicle-type-name {
        color: white;
    }

    .vehicle-type-badge {
        position: absolute;
        top: 8px;
        right: 8px;
        background: #fbbf24;
        color: #1e3a8a;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.7rem;
        font-weight: bold;
    }

    /* Finance-specific sections */
    .finance-section {
        display: none;
        background: #fffbeb;
        border: 2px solid #fbbf24;
        border-radius: 12px;
        padding: 25px;
        margin: 20px 0;
    }

    .finance-section.active {
        display: block;
        animation: fadeIn 0.3s ease-in;
    }

    .finance-section h3 {
        color: #92400e;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .finance-warning {
        background: #fef3c7;
        border: 1px solid #fbbf24;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 20px;
    }

    .finance-warning-icon {
        color: #f59e0b;
        font-size: 1.2rem;
        margin-right: 8px;
    }

    .finance-calculator {
        background: #f0f9ff;
        border: 1px solid #bfdbfe;
        border-radius: 12px;
        padding: 20px;
        margin-top: 20px;
    }

    .calculator-result {
        background: white;
        padding: 15px;
        border-radius: 8px;
        margin-top: 15px;
        text-align: center;
    }

    .monthly-payment {
        font-size: 1.8rem;
        font-weight: bold;
        color: #1e3a8a;
    }

    /* Finance Toggle Styles */
.finance-toggle-container {
    margin: 20px 0 30px 0;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 12px;
    border: 1px solid #e5e7eb;
}

.finance-toggle {
    display: flex;
    align-items: center;
    cursor: pointer;
    margin-bottom: 8px;
}

.finance-toggle-input {
    display: none;
}

.finance-toggle-slider {
    position: relative;
    width: 200px;
    height: 50px;
    background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
    border-radius: 25px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 4px;
    box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
}

.finance-toggle-slider::before {
    content: '';
    position: absolute;
    top: 4px;
    left: 4px;
    width: 96px;
    height: 42px;
    background: white;
    border-radius: 21px;
    transition: transform 0.3s ease;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.finance-toggle-input:checked + .finance-toggle-slider::before {
    transform: translateX(96px);
}

.toggle-text {
    position: relative;
    z-index: 1;
    font-weight: 600;
    font-size: 0.875rem;
    color: white;
    padding: 0 12px;
    transition: color 0.3s ease;
}

.finance-toggle-input:not(:checked) + .finance-toggle-slider .toggle-text:first-child {
    color: #f59e0b;
}

.finance-toggle-input:checked + .finance-toggle-slider .toggle-text:last-child {
    color: #f59e0b;
}

.finance-toggle-desc {
    font-size: 0.875rem;
    color: #6b7280;
    margin: 0;
    font-style: italic;
}

/* Disabled state for finance toggle */
.finance-toggle.disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.finance-toggle.disabled .finance-toggle-slider {
    background: #9ca3af;
    box-shadow: none;
}
    
    /* Selected Display */
    .selected-display {
        margin-top: 20px;
        padding: 16px;
        background: #f9fafb;
        border-radius: 8px;
        border: 1px solid #e5e7eb;
        font-weight: 500;
        color: #374151;
    }
    
    /* Photo Upload */
    .photo-upload-area {
        border: 2px dashed #d1d5db;
        border-radius: 10px;
        padding: 40px;
        text-align: center;
        background: #f9fafb;
        transition: all 0.3s;
        cursor: pointer;
    }
    
    .photo-upload-area:hover {
        border-color: #1e3a8a;
        background: #f0f9ff;
    }
    
    .photo-upload-area.dragover {
        border-color: #1e3a8a;
        background: #eff6ff;
    }
    
    .upload-icon {
        font-size: 3rem;
        color: #6b7280;
        margin-bottom: 15px;
    }
    
    .upload-text {
        font-size: 1.1rem;
        color: #374151;
        margin-bottom: 8px;
    }
    
    .upload-hint {
        font-size: 0.9rem;
        color: #6b7280;
    }
    
    .photo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }
    
    .photo-item {
        position: relative;
        aspect-ratio: 4/3;
        border-radius: 8px;
        overflow: hidden;
        border: 2px solid #e5e7eb;
    }
    
    .photo-preview {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .photo-remove {
        position: absolute;
        top: 5px;
        right: 5px;
        background: rgba(239, 68, 68, 0.9);
        color: white;
        border: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: background 0.3s;
    }
    
    .photo-remove:hover {
        background: #ef4444;
    }
    
    .photo-main-indicator {
        position: absolute;
        bottom: 5px;
        left: 5px;
        background: rgba(30, 58, 138, 0.9);
        color: white;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 600;
    }
    
    /* Sidebar */
    .sidebar {
        display: flex;
        flex-direction: column;
        gap: 20px;
        position: relative;
        z-index: 1;
    }
    
    .sidebar-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .sidebar-title {
        font-size: 1.2rem;
        color: #1f2937;
        margin-bottom: 15px;
        font-weight: 600;
    }
    
    /* Tips Card */
    .tips-list {
        list-style: none;
        font-size: 0.9rem;
        color: #6b7280;
    }
    
    .tips-list li {
        margin-bottom: 8px;
        padding-left: 20px;
        position: relative;
    }
    
    .tips-list li:before {
   content: "";
   position: absolute;
   left: 0;
   width: 16px;
   height: 16px;
   background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256"><rect width="256" height="256" fill="none"/><polyline points="40 144 96 200 224 72" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/></svg>');
   background-size: contain;
   background-repeat: no-repeat;
   }
    
    /* Form Actions */
    .form-actions {
        grid-column: 1 / -1;
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
    }
    
    .btn-secondary {
        background: #6b7280;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
    }
    
    .btn-secondary:hover {
        background: #4b5563;
    }
    
    .btn-submit {
        background: #1e3a8a;
        color: white;
        border: none;
        padding: 12px 32px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.3s;
        font-size: 1.1rem;
    }
    
    .btn-submit:hover {
        background: #1e40af;
    }
    
    .btn-submit:disabled {
        background: #9ca3af;
        cursor: not-allowed;
    }
    
    /* AI Description Generator Styles */
    .ai-description-container {
        max-width: 800px;
        margin: 0 auto 25px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        overflow: hidden;
        transition: all 0.3s ease;
    }
    
    .ai-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: 24px 32px;
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .ai-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: pulse 4s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(0.8); opacity: 0.5; }
        50% { transform: scale(1.2); opacity: 0.8; }
    }
    
    .ai-header-content {
        position: relative;
        z-index: 1;
    }
    
    .ai-title {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .ai-icon {
        width: 32px;
        height: 32px;
        background: rgba(255,255,255,0.2);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }
    
    .ai-subtitle {
        font-size: 0.95rem;
        opacity: 0.9;
        font-weight: 400;
    }
    
    .ai-status-bar {
        background: rgba(255,255,255,0.1);
        backdrop-filter: blur(10px);
        padding: 12px 20px;
        margin-top: 16px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        gap: 16px;
    }
    
    .status-indicator {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #10b981;
        animation: statusPulse 2s ease-in-out infinite;
    }
    
    @keyframes statusPulse {
        0%, 100% { opacity: 0.5; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.2); }
    }
    
    .status-text {
        font-size: 0.875rem;
        flex: 1;
    }
    
    .ai-credit {
        font-size: 0.75rem;
        opacity: 0.8;
    }
    
    .ai-content {
        padding: 32px;
    }
    
    .writing-assistant {
        display: grid;
        grid-template-columns: 200px 1fr;
        gap: 24px;
        margin-bottom: 24px;
    }
    
    .style-selector {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .style-option {
        background: #f8f9fa;
        border: 2px solid transparent;
        padding: 12px 16px;
        border-radius: 12px;
        cursor: pointer;
        transition: all 0.2s ease;
        position: relative;
        overflow: hidden;
    }
    
    .style-option:hover {
        background: #f3f4f6;
        transform: translateX(4px);
    }
    
    .style-option.active {
        background: #eff6ff;
        border-color: #667eea;
        color: #667eea;
    }
    
    .style-option.active::after {
        content: '✓';
        position: absolute;
        right: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-weight: bold;
    }
    
    .style-name {
        font-weight: 600;
        font-size: 0.9rem;
        margin-bottom: 2px;
    }
    
    .style-desc {
        font-size: 0.75rem;
        color: #6b7280;
        line-height: 1.3;
    }
    
    .text-editor {
        background: #f8f9fa;
        border-radius: 12px;
        overflow: hidden;
        border: 1px solid #e5e7eb;
        transition: all 0.2s ease;
    }
    
    .text-editor:focus-within {
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    .editor-toolbar {
        background: white;
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .toolbar-btn {
        background: transparent;
        border: none;
        padding: 6px 10px;
        border-radius: 6px;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9rem;
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 4px;
    }
    
    .toolbar-btn:hover {
        background: #f3f4f6;
        color: #374151;
    }
    
    .toolbar-btn.active {
        background: #eff6ff;
        color: #667eea;
    }
    
    .toolbar-separator {
        width: 1px;
        height: 20px;
        background: #e5e7eb;
        margin: 0 4px;
    }
    
    .editor-textarea {
        width: 100%;
        min-height: 200px;
        padding: 16px;
        border: none;
        background: transparent;
        font-family: inherit;
        font-size: 0.95rem;
        line-height: 1.6;
        resize: vertical;
        outline: none;
    }
    
    .editor-footer {
        background: white;
        padding: 12px 16px;
        border-top: 1px solid #e5e7eb;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .char-count {
        font-size: 0.8rem;
        color: #6b7280;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .char-progress {
        width: 60px;
        height: 4px;
        background: #e5e7eb;
        border-radius: 2px;
        overflow: hidden;
    }
    
    .char-fill {
        height: 100%;
        background: #667eea;
        transition: width 0.3s ease;
    }
    
    /* Quality Score */
    .quality-panel {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 24px;
        border: 1px solid #bfdbfe;
    }
    
    .quality-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }
    
    .quality-title {
        font-weight: 600;
        color: #1e40af;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .quality-badge {
        background: white;
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 700;
        color: #1e40af;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .quality-bar-container {
        background: white;
        border-radius: 8px;
        padding: 4px;
        margin-bottom: 16px;
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
    }
    
    .quality-bar {
        height: 8px;
        background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);
        border-radius: 4px;
        position: relative;
        overflow: hidden;
    }
    
    .quality-marker {
        position: absolute;
        top: -4px;
        width: 16px;
        height: 16px;
        background: white;
        border: 3px solid #667eea;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        transition: left 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .improvement-tips {
        display: grid;
        gap: 8px;
    }
    
    .tip {
        background: white;
        padding: 12px 16px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        gap: 12px;
        font-size: 0.875rem;
        color: #374151;
        transition: all 0.2s;
        cursor: pointer;
    }
    
    .tip:hover {
        transform: translateX(4px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    
    .tip-icon {
        width: 32px;
        height: 32px;
        background: #fef3c7;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        flex-shrink: 0;
    }
    
    .tip-content {
        flex: 1;
    }
    
    .tip-points {
        font-weight: 600;
        color: #10b981;
        font-size: 0.75rem;
    }
    
    .ai-actions {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    .ai-btn {
        padding: 12px 24px;
        border-radius: 10px;
        font-weight: 600;
        font-size: 0.95rem;
        cursor: pointer;
        transition: all 0.2s;
        border: none;
        display: flex;
        align-items: center;
        gap: 8px;
        position: relative;
        overflow: hidden;
    }
    
    .ai-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
        transition: left 0.5s;
    }
    
    .ai-btn:hover::before {
        left: 100%;
    }
    
    .ai-btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }
    
    .ai-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
    }
    
    .ai-btn-secondary {
        background: white;
        color: #6b7280;
        border: 2px solid #e5e7eb;
    }
    
    .ai-btn-secondary:hover {
        border-color: #667eea;
        color: #667eea;
        background: #f8f9ff;
    }
    
    .ai-loading {
        text-align: center;
        padding: 40px;
    }
    
    .loading-animation {
        width: 60px;
        height: 60px;
        margin: 0 auto 20px;
        position: relative;
    }
    
    .loading-ring {
        position: absolute;
        width: 100%;
        height: 100%;
        border: 3px solid #e5e7eb;
        border-radius: 50%;
        border-top-color: #667eea;
        animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .loading-text {
        font-weight: 600;
        color: #374151;
        margin-bottom: 8px;
    }
    
    .loading-subtitle {
        font-size: 0.875rem;
        color: #6b7280;
    }
    
    /* Success Message */
    .success-message {
        display: none;
        text-align: center;
        padding: 40px;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .success-icon {
        font-size: 4rem;
        color: #10b981;
        margin-bottom: 20px;
    }
    
    .success-title {
        font-size: 1.8rem;
        color: #1f2937;
        margin-bottom: 10px;
    }
    
    .success-text {
        color: #6b7280;
        margin-bottom: 25px;
    }
    
    /* Checkbox Group */
    .checkbox-group {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin-top: 10px;
    }
    
    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 8px;
        border-radius: 5px;
        transition: background 0.3s;
    }
    
    .checkbox-item:hover {
        background: #f9fafb;
    }
    
    .checkbox-item input[type="checkbox"] {
        margin: 0;
    }
    
    .checkbox-item label {
        margin: 0;
        cursor: pointer;
        font-size: 0.9rem;
    }
    
    /* Demo Info */
    .demo-info {
        margin-top: 32px;
        padding: 20px;
        background: #f0f9ff;
        border-radius: 12px;
        border: 1px solid #bfdbfe;
    }
    
    .demo-info h3 {
        color: #1e40af;
        margin-bottom: 8px;
        font-size: 1.1rem;
    }
    
    .demo-info p {
        color: #1e40af;
        font-size: 0.95rem;
        opacity: 0.8;
    }
    
    /* Footer */
    footer {
        background: #1f2937;
        color: white;
        padding: 50px 0 20px;
        margin-top: 50px;
        flex-shrink: 0;
        width: 100%;
        grid-column: 1 / -1; /* Add this line */
    }
    
    .footer-content {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 30px;
    }
    
    .footer-section h3 {
        margin-bottom: 20px;
        color: #fbbf24;
    }
    
    .footer-section a {
        color: #d1d5db;
        text-decoration: none;
        display: block;
        margin-bottom: 10px;
    }
    
    .footer-section a:hover {
        color: #fbbf24;
    }
    
    .footer-bottom {
        border-top: 1px solid #374151;
        margin-top: 30px;
        padding-top: 20px;
        text-align: center;
        color: #9ca3af;
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
        .main-container {
            grid-template-columns: 1fr;
            gap: 20px;
        }
    
        .sidebar {
            order: -1;
        }
    }
    
    @media (max-width: 768px) {
        .page-title {
            font-size: 2rem;
        }
    
        .section-title {
            font-size: 1.5rem;
        }
    
        .progress-steps {
            flex-direction: column;
            gap: 10px;
        }
    
        .form-grid {
            grid-template-columns: 1fr;
        }
    
        .vehicle-types {
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
    
        .vehicle-type {
            height: 100px;
            padding: 16px 12px;
        }
    
        .vehicle-type-icon {
            width: 40px;
            height: 40px;
            font-size: 1.3rem;
        }
    
        .vehicle-type-name {
            font-size: 0.85rem;
        }
    
        .form-actions {
            flex-direction: column;
            gap: 15px;
        }
    
        .main-container {
            padding: 0 15px;
        }
    
        .writing-assistant {
            grid-template-columns: 1fr;
        }
    
        .style-selector {
            flex-direction: row;
            overflow-x: auto;
            padding-bottom: 8px;
        }
    
        .style-option {
            min-width: 150px;
        }
    
        .ai-actions {
            flex-direction: column;
        }
    
        .ai-btn {
            width: 100%;
            justify-content: center;
        }
    }
    
    @media (max-width: 480px) {
        .container {
            padding: 24px;
        }
    
        .vehicle-types {
            grid-template-columns: 1fr 1fr;
        }
    }
    
    /* Animations */
    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .slide-in {
        animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    /* Step feedback animation */
    @keyframes slideInRight {
        from { transform: translateX(100%); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
    
    @keyframes slideOutRight {
        from { transform: translateX(0); opacity: 1; }
        to { transform: translateX(100%); opacity: 0; }
    }

    /* Searchable Dropdown Styles */
    .searchable-dropdown {
        position: relative;
        width: 100%
    }

    .searchable-input {
        width:100%;
        padding-right: 40px !important;
        cursor: pointer;
    }

    .searchable-input:disabled {
        background-color: #f9fafb;
        cursor: not-allowed;
    }

    .dropdown-arrow {
        position: absolute;
        right: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        pointer-events: none;
        transition: transform 0.2s ease;
    }

    .searchable-dropdown.active .dropdown-arrow {
        transform: translateY(-50%) rotate(180deg);
    }

    .dropdown-options {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: white;
        border: 2px solid #d1d5db;
        border-top: none;
        border-radius: 0 0 8px 8px;
        max-height: 200px;
        overflow-y: auto;
        z-index: 1000;
        display: none;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    }

    .searchable-dropdown.active .dropdown-options {
        display: block;
    }

    .dropdown-option {
        padding: 12px 16px;
        cursor: pointer;
        border-bottom: 1px solid #f3f4f6;
        transition: background-color 0.15s ease;
        font-size: 0.95rem;
    }

    .dropdown-option:last-child {
        border-bottom: none;
    }

    .dropdown-option:hover {
        background-color: #f9fafb;
    }

    .dropdown-option.selected {
        background-color: #eff6ff;
        color: #1e40af;
        font-weight: 500;
    }

    .dropdown-option.highlighted {
        background-color: #f0f9ff;
    }

    .dropdown-option .option-main {
        font-weight: 500;
        color: #1f2937;
    }

    .dropdown-option .option-sub {
        font-size: 0.85rem;
        color: #6b7280;
        margin-top: 2px;
    }

    .no-results {
        padding: 16px;
        text-align: center;
        color: #6b7280;
        font-style: italic;
    }

    .dropdown-loading {
        padding: 16px;
        text-align: center;
        color: #6b7280;
        font-style: italic;
    }

    .dropdown-loading::after {
        content: "";
        display: inline-block;
        width: 16px;
        height: 16px;
        border: 2px solid #e5e7eb;
        border-top: 2px solid #3b82f6;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-left: 8px;
    }

    /* Improved scrolling for long lists */
    .dropdown-options {
        scrollbar-width: thin;
        scrollbar-color: #d1d5db #f9fafb;
    }

    .dropdown-options::-webkit-scrollbar {
        width: 6px;
    }

    .dropdown-options::-webkit-scrollbar-track {
        background: #f9fafb;
    }

    .dropdown-options::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
    }

    .dropdown-options::-webkit-scrollbar-thumb:hover {
        background: #9ca3af;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .dropdown-options {
            max-height: 150px;
        }
        
        .dropdown-option {
            padding: 10px 12px;
        }
    }

</style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">AutoTrader.lk</a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#research">Research & Reviews</a></li>
                    <li><a href="#financing">Financing</a></li>
                    <li><a href="#wanted">Wanted Requests</a></li>
                    <li><a href="#import">Import Service</a></li>
                </ul>
            </nav>
            <div class="user-actions">
                <a href="#favorites" class="icon-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 24px; height: 24px;">
                        <rect width="256" height="256" fill="none"/>
                        <path d="M128,224S24,168,24,102A54,54,0,0,1,78,48c22.59,0,41.94,12.31,50,32,8.06-19.69,27.41-32,50-32a54,54,0,0,1,54,54C232,168,128,224,128,224Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                    </svg>
                </a>
                <a href="#profile" class="icon-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 24px; height: 24px;">
                        <rect width="256" height="256" fill="none"/>
                        <circle cx="128" cy="96" r="64" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                        <path d="M32,216c19.37-33.47,54.55-56,96-56s76.63,22.53,96,56" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                    </svg>
                </a>
                <a href="#sell" class="btn-primary">Post Ad</a>
             </div>
        </div>
    </header>

    <!-- Breadcrumb -->
    <nav class="breadcrumb">
        <div class="breadcrumb-content">
            <a href="/">Home</a> > <span>Post Ad</span>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <h1 class="page-title">Sell Your Vehicle</h1>
            <p class="page-subtitle">Reach thousands of potential buyers across Sri Lanka</p>
            
            <div class="progress-steps">
                <div class="step active">
                    <div class="step-number">1</div>
                    <span>Vehicle Details</span>
                </div>
                <div class="step inactive">
                    <div class="step-number">2</div>
                    <span>Photos & Description</span>
                </div>
                <div class="step inactive">
                    <div class="step-number">3</div>
                    <span>Contact & Publish</span>
                </div>
            </div>
        </div>

        <!-- Form Container -->
        <div class="form-container">
            <form id="post-ad-form">
                <!-- Step 1: Vehicle Type -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg viewBox="0 0 24 24" fill="currentColor" style="width: 20px; height: 20px;">
                                <path d="M18.92 6.01C18.72 5.42 18.16 5 17.5 5h-11c-.66 0-1.22.42-1.42 1.01L3 12v8c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-1h12v1c0 .55.45 1 1 1h1c.55 0 1-.45 1-1v-8l-2.08-5.99zM6.5 16c-.83 0-1.5-.67-1.5-1.5S5.67 13 6.5 13s1.5.67 1.5 1.5S7.33 16 6.5 16zm11 0c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zM5 11l1.5-4.5h11L19 11H5z"/>
                            </svg>
                        </div>
                        What type of vehicle are you selling?
                    </h2>
                    <p class="section-subtitle">Select the category that best describes your vehicle</p>
                    
                    <div class="vehicle-types">
                        <div class="vehicle-type" data-type="car" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <circle cx="64" cy="176" r="24"/>
                                    <circle cx="192" cy="176" r="24"/>
                                    <line x1="88" y1="176" x2="168" y2="176"/>
                                    <path d="M216,176h24a8,8,0,0,0,8-8V128a8,8,0,0,0-8-8H208L162.34,74.34A8,8,0,0,0,156.69,72H44.28a8,8,0,0,0-6.65,3.56L8,120v48a8,8,0,0,0,8,8H40"/>
                                    <line x1="208" y1="120" x2="8" y2="120"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Cars</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="motorcycle" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <circle cx="40" cy="160" r="32"/>
                                    <circle cx="216" cy="160" r="32"/>
                                    <polyline points="144 56 176 56 216 160"/>
                                    <path d="M16,80s47.31,18.34,72.56,29.81a24,24,0,0,0,25.16-3.18C121.64,100.09,134.4,96,152,96h64a64,64,0,0,0-61.65,46.75,23.83,23.83,0,0,1-23,17.25H40"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Motorcycles</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="three-wheeler" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg fill="#000000" width="800px" height="800px" viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><path d="M16.984375 6.9863281 A 1.0001 1.0001 0 0 0 16.839844 7L9 7C4.0414839 7 0 11.041484 0 16L0 18.832031 A 1.0001 1.0001 0 0 0 0 19.158203L0 33C0 35.197334 1.8026661 37 4 37L4.0410156 37C4.0272801 37.166874 4 37.332921 4 37.5C4 38.847222 4.4436807 40.207881 5.3769531 41.257812C6.3102255 42.307744 7.7500005 43 9.5 43C11.249999 43 12.689774 42.307744 13.623047 41.257812C14.556319 40.207881 15 38.847222 15 37.5C15 37.332921 14.97272 37.166874 14.958984 37L35 37 A 1.0001 1.0001 0 0 0 35.613281 36.789062L36.626953 36L38.457031 36C38.303389 36.505796 38 36.946603 38 37.5C38 40.525577 40.474423 43 43.5 43C46.525577 43 49 40.525577 49 37.5C49 36.946603 48.696611 36.505796 48.542969 36L49 36 A 1.0001 1.0001 0 0 0 49.980469 34.804688C49.159078 30.697736 46.34396 28.940635 44.986328 28.318359C44.8327 18.771616 41.531565 11.925828 39.816406 9L43 9 A 1.0001 1.0001 0 1 0 43 7L38.027344 7L38 7L35.154297 7 A 1.0001 1.0001 0 0 0 34.984375 6.9863281 A 1.0001 1.0001 0 0 0 34.839844 7L17.154297 7 A 1.0001 1.0001 0 0 0 16.984375 6.9863281 z M 9 9L16 9L16 18L2 18L2 16C2 12.122516 5.1225161 9 9 9 z M 18 9L30 9L30 25.5C30 28.541589 27.541589 31 24.5 31L22 31L22 28C22 25.592847 20.274577 23.568451 18 23.101562L18 19.167969 A 1.0001 1.0001 0 0 0 18 18.841797L18 9 z M 32 9L34 9L34 23 A 1.0001 1.0001 0 0 0 35 24L42.669922 24C42.841962 25.424157 42.955693 26.929522 42.974609 28.53125L35.753906 34.146484 A 1.0001 1.0001 0 0 0 35.566406 34.292969L34.65625 35L14.425781 35C14.213928 34.55303 13.961459 34.122901 13.623047 33.742188C12.689774 32.692256 11.249999 32 9.5 32C7.7500005 32 6.3102255 32.692256 5.3769531 33.742188C5.0385408 34.122901 4.7860723 34.55303 4.5742188 35L4 35C2.8833339 35 2 34.116666 2 33L2 25L16.832031 25 A 1.0001 1.0001 0 0 0 17.091797 25.009766C18.715894 25.058805 20 26.363056 20 28L20 32 A 1.0001 1.0001 0 0 0 21 33L24.5 33C28.626411 33 32 29.626411 32 25.5L32 9 z M 36 9L37.457031 9C38.015125 9.7885409 41.06846 14.391308 42.376953 22L36 22L36 9 z M 2 20L16 20L16 23L2 23L2 20 z M 44.171875 30.132812C44.948864 30.483725 46.638496 31.500405 47.560547 34L47.240234 34L39.759766 34L39.199219 34L44.171875 30.132812 z M 9.5 34C9.719244 34 9.9083173 34.029292 10.101562 34.054688C11.355475 34.272648 12.363845 35.157967 12.78125 36.333984 A 1.0001 1.0001 0 0 0 12.855469 36.492188C12.941881 36.819098 13 37.156001 13 37.5C13 38.402778 12.69368 39.292119 12.126953 39.929688C11.560226 40.567256 10.749999 41 9.5 41C8.2500008 41 7.4397738 40.567256 6.8730469 39.929688C6.3063199 39.292119 6 38.402778 6 37.5C6 37.157282 6.058752 36.8219 6.1445312 36.496094 A 1.0001 1.0001 0 0 0 6.21875 36.335938C6.6370631 35.159262 7.6447201 34.2729 8.8984375 34.054688C9.0916827 34.029292 9.280756 34 9.5 34 z M 40.455078 36L46.544922 36C46.775688 36.46567 47 36.94237 47 37.5C47 39.444423 45.444423 41 43.5 41C41.555577 41 40 39.444423 40 37.5C40 36.94237 40.224312 36.46567 40.455078 36 z"/></svg>
                            </div>
                            <div class="vehicle-type-name">Three Wheelers</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="bicycle" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <path d="M208,80a16,16,0,0,0-16-16H152l56,96"/>
                                    <circle cx="208" cy="160" r="40"/>
                                    <circle cx="48" cy="160" r="40"/>
                                    <polyline points="48 64 76 64 132 160"/>
                                    <polyline points="170.67 96 94.67 96 48 160"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Bicycles</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="van" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <circle cx="192" cy="184" r="24"/>
                                    <circle cx="80" cy="184" r="24"/>
                                    <line x1="168" y1="184" x2="104" y2="184"/>
                                    <path d="M216,184h24a8,8,0,0,0,8-8V112L202.4,58.87A8,8,0,0,0,196.26,56H32a8,8,0,0,0-8,8V176a8,8,0,0,0,8,8H56"/>
                                    <line x1="24" y1="112" x2="248" y2="112"/>
                                    <line x1="168" y1="56" x2="168" y2="112"/>
                                    <line x1="96" y1="56" x2="96" y2="112"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Vans</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="bus" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <line x1="48" y1="72" x2="208" y2="72"/>
                                    <line x1="48" y1="112" x2="208" y2="112"/>
                                    <path d="M208,184H48V64A24,24,0,0,1,72,40H184a24,24,0,0,1,24,24Z"/>
                                    <path d="M208,184v24a8,8,0,0,1-8,8H176a8,8,0,0,1-8-8V184"/>
                                    <path d="M88,184v24a8,8,0,0,1-8,8H56a8,8,0,0,1-8-8V184"/>
                                    <circle cx="92" cy="148" r="12"/>
                                    <circle cx="164" cy="148" r="12"/>
                                    <line x1="240" y1="80" x2="240" y2="104"/>
                                    <line x1="16" y1="80" x2="16" y2="104"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Buses</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="truck" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <path d="M184,80h42.58A8,8,0,0,1,234,85l14,35"/>
                                    <line x1="24" y1="144" x2="184" y2="144"/>
                                    <circle cx="192" cy="192" r="24"/>
                                    <circle cx="80" cy="192" r="24"/>
                                    <line x1="168" y1="192" x2="104" y2="192"/>
                                    <path d="M184,120h64v64a8,8,0,0,1-8,8H216"/>
                                    <path d="M56,192H32a8,8,0,0,1-8-8V72a8,8,0,0,1,8-8H184V169.37"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Lorries & Trucks</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="heavy-duty" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <rect x="8" y="144" width="184" height="64" rx="32"/>
                                    <line x1="56" y1="48" x2="56" y2="144"/>
                                    <path d="M248,144h-8a16,16,0,0,0-16,16v32a16,16,0,0,0,16,16h8"/>
                                    <line x1="40" y1="176" x2="160" y2="176"/>
                                    <path d="M16,154.83V56a8,8,0,0,1,8-8h90.67a8,8,0,0,1,7.38,4.92L160,144"/>
                                    <line x1="192" y1="176" x2="224" y2="176"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Heavy Duty</div>
                        </div>
                        
                        <div class="vehicle-type" data-type="tractor" data-category="regular">
                            <div class="vehicle-type-icon">
                                <svg viewBox="0 0 256 256" fill="none" stroke="currentColor" stroke-width="16">
                                    <circle cx="212" cy="188" r="28"/>
                                    <circle cx="68" cy="172" r="44"/>
                                    <circle cx="68" cy="172" r="12" fill="currentColor"/>
                                    <path d="M232,168V134a8,8,0,0,0-5.7-7.66L144,104V48H56V96"/>
                                    <line x1="40" y1="48" x2="56" y2="48"/>
                                    <line x1="144" y1="48" x2="160" y2="48"/>
                                    <path d="M40,96H68a76,76,0,0,1,76,76v12h40.28"/>
                                    <line x1="144" y1="104" x2="144" y2="184"/>
                                    <line x1="184" y1="114.83" x2="184" y2="72"/>
                                </svg>
                            </div>
                            <div class="vehicle-type-name">Tractors</div>
                        </div>
                    </div>

                    <div class="selected-display" id="selected-display">
                        Please select a vehicle type above
                    </div>
                </div>
                <!-- Step 2: Basic Details -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;">
                                <rect width="256" height="256" fill="none"/>
                                <line x1="96" y1="152" x2="160" y2="152" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <line x1="96" y1="120" x2="160" y2="120" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <path d="M160,40h40a8,8,0,0,1,8,8V216a8,8,0,0,1-8,8H56a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8H96" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <path d="M88,72V64a40,40,0,0,1,80,0v8Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                            </svg>
                        </div>
                        Basic Vehicle Information
                    </h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="make">
                                Make <span class="required">*</span>
                            </label>
                            <select class="form-select" id="make" required>
                                <option value="">Select Make</option>
                                <option value="toyota">Toyota</option>
                                <option value="honda">Honda</option>
                                <option value="nissan">Nissan</option>
                                <option value="mazda">Mazda</option>
                                <option value="suzuki">Suzuki</option>
                                <option value="mitsubishi">Mitsubishi</option>
                                <option value="hyundai">Hyundai</option>
                                <option value="kia">Kia</option>
                                <option value="bmw">BMW</option>
                                <option value="mercedes">Mercedes-Benz</option>
                                <option value="audi">Audi</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="model">
                                Model <span class="required">*</span>
                            </label>
                            <select class="form-select" id="model" required disabled>
                                <option value="">Select Model</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="year">
                                Year <span class="required">*</span>
                            </label>
                            <select class="form-select" id="year" required>
                                <option value="">Select Year</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="mileage">
                                Mileage (km) <span class="required">*</span>
                            </label>
                            <input type="number" class="form-input" id="mileage" placeholder="e.g., 45000" required>
                            <div class="input-hint">Enter the current mileage of your vehicle</div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="fuel-type">
                                Fuel Type <span class="required">*</span>
                            </label>
                            <select class="form-select" id="fuel-type" required>
                                <option value="">Select Fuel Type</option>
                                <option value="petrol">Petrol</option>
                                <option value="diesel">Diesel</option>
                                <option value="hybrid">Hybrid</option>
                                <option value="electric">Electric</option>
                                <option value="cng">CNG</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="transmission">
                                Transmission <span class="required">*</span>
                            </label>
                            <select class="form-select" id="transmission" required>
                                <option value="">Select Transmission</option>
                                <option value="automatic">Automatic</option>
                                <option value="manual">Manual</option>
                                <option value="cvt">CVT</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="engine-capacity">
                                Engine Capacity (cc)
                            </label>
                            <input type="number" class="form-input" id="engine-capacity" placeholder="e.g., 1800">
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="color">
                                Color
                            </label>
                            <select class="form-select" id="color">
                                <option value="">Select Color</option>
                                <option value="white">White</option>
                                <option value="black">Black</option>
                                <option value="silver">Silver</option>
                                <option value="gray">Gray</option>
                                <option value="red">Red</option>
                                <option value="blue">Blue</option>
                                <option value="green">Green</option>
                                <option value="yellow">Yellow</option>
                                <option value="brown">Brown</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Pricing -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;" fill="currentColor">
                                <rect width="256" height="256" fill="none"/>
                                <line x1="128" y1="24" x2="128" y2="232" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <path d="M184,88a40,40,0,0,0-40-40H112a40,40,0,0,0,0,80h40a40,40,0,0,1,0,80H104a40,40,0,0,1-40-40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                            </svg>
                        </div>
                        Pricing
                    </h2>

                    <!-- Finance/Leasing Toggle -->
                    <div class="finance-toggle-container">
                        <label class="finance-toggle">
                            <input type="checkbox" id="finance-toggle" class="finance-toggle-input">
                            <div class="finance-toggle-slider">
                                <span class="toggle-text">Regular Sale</span>
                                <span class="toggle-text active">Finance Transfer</span>
                            </div>
                        </label>
                        <p class="finance-toggle-desc">Toggle if you're transferring a vehicle under finance/leasing</p>
                    </div>

                    <!-- Regular Pricing Fields -->
<div id="regular-pricing" class="pricing-section active">
    <div class="form-grid">
        <div class="form-group">
            <label class="form-label" for="price">
                Asking Price (LKR) <span class="required">*</span>
            </label>
            <input type="number" class="form-input" id="price" placeholder="e.g., 4500000" required>
            <div class="input-hint">Set a competitive price to attract more buyers</div>
        </div>

        <div class="form-group">
            <div class="checkbox-item" style="margin-top: 8px;">
                <input type="checkbox" id="negotiable" name="negotiable" value="yes">
                <label for="negotiable" class="form-label" style="margin-bottom: 0; cursor: pointer;">
                    Price Negotiable?
                </label>
            </div>
            <div class="input-hint" style="margin-left: 28px;">
                Check if you're willing to negotiate on the price
            </div>
        </div>
    </div>
</div>

<!-- Finance Pricing Fields (hidden by default) -->
<div id="finance-pricing" class="pricing-section" style="display: none;">
    <div class="finance-warning">
        <span class="finance-warning-icon">⚠️</span>
        <strong>Important Notice:</strong> You are listing a vehicle that is currently under a finance/leasing agreement. 
        The buyer will take over the remaining payments and obligations. Please ensure all information is accurate 
        and consult with your finance provider before proceeding.
    </div>

    <h3>
        💼 Finance/Leasing Information
    </h3>

    <div class="form-grid">
        <div class="form-group">
            <label class="form-label" for="finance-type">
                Finance Type <span class="required">*</span>
            </label>
            <select class="form-select" id="finance-type" required>
                <option value="">Select Finance Type</option>
                <option value="bank-loan">Bank Loan</option>
                <option value="leasing">Leasing Agreement</option>
                <option value="hire-purchase">Hire Purchase</option>
                <option value="finance-company">Finance Company Loan</option>
                <option value="dealer-finance">Dealer Finance</option>
            </select>
        </div>

        <div class="form-group">
            <label class="form-label" for="finance-provider">
                Finance Provider <span class="required">*</span>
            </label>
            <input type="text" class="form-input" id="finance-provider" 
                   placeholder="e.g., Commercial Bank, Softlogic Finance" required>
            <div class="input-hint">Name of the bank or finance company</div>
        </div>

        <div class="form-group">
            <label class="form-label" for="original-amount">
                Original Finance Amount (LKR) <span class="required">*</span>
            </label>
            <input type="number" class="form-input" id="original-amount" 
                   placeholder="e.g., 6000000" required>
        </div>

        <div class="form-group">
            <label class="form-label" for="outstanding-amount">
                Outstanding Amount (LKR) <span class="required">*</span>
            </label>
            <input type="number" class="form-input" id="outstanding-amount" 
                   placeholder="e.g., 3500000" required>
            <div class="input-hint">Current remaining balance</div>
        </div>

        <div class="form-group">
            <label class="form-label" for="monthly-payment">
                Monthly Payment (LKR) <span class="required">*</span>
            </label>
            <input type="number" class="form-input" id="monthly-payment" 
                   placeholder="e.g., 125000" required>
        </div>

        <div class="form-group">
            <label class="form-label" for="remaining-months">
                Remaining Months <span class="required">*</span>
            </label>
            <input type="number" class="form-input" id="remaining-months" 
                   placeholder="e.g., 36" required>
        </div>

        <div class="form-group">
            <label class="form-label" for="interest-rate">
                Interest Rate (%)
            </label>
            <input type="number" class="form-input" id="interest-rate" 
                   placeholder="e.g., 12.5" step="0.1">
        </div>

        <div class="form-group">
            <label class="form-label" for="next-payment-date">
                Next Payment Due Date
            </label>
            <input type="date" class="form-input" id="next-payment-date">
        </div>

        <div class="form-group full-width">
            <label class="form-label" for="asking-price-finance">
                Your Asking Price (LKR) <span class="required">*</span>
            </label>
            <div style="display: flex; gap: 15px; align-items: flex-start;">
                <input type="number" class="form-input" id="asking-price-finance" 
                       placeholder="e.g., 4500000" required style="flex: 1;">
                <div class="checkbox-item" style="margin-top: 12px; min-width: 140px;">
                    <input type="checkbox" id="finance-negotiable" name="finance-negotiable" value="yes">
                    <label for="finance-negotiable" style="margin: 0; cursor: pointer; font-size: 0.9rem;">
                        Negotiable?
                    </label>
                </div>
            </div>
            <div class="input-hint">
                This is what you're asking from the buyer. They will pay this amount to you, 
                plus take over the remaining finance payments.
            </div>
        </div>

        <div class="form-group full-width">
            <label class="form-label">Transfer Requirements</label>
            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="credit-check" name="requirements[]" value="credit-check">
                    <label for="credit-check">Buyer must pass credit check with finance provider</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="income-proof" name="requirements[]" value="income-proof">
                    <label for="income-proof">Proof of income required</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="guarantor" name="requirements[]" value="guarantor">
                    <label for="guarantor">Guarantor may be required</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="transfer-fee" name="requirements[]" value="transfer-fee">
                    <label for="transfer-fee">Transfer fees apply (buyer responsibility)</label>
                </div>
            </div>
        </div>

        <div class="form-group full-width">
            <label class="form-label" for="finance-notes">
                Additional Finance Notes
            </label>
            <textarea class="form-textarea" id="finance-notes" rows="4" 
                      placeholder="Any additional information about the finance agreement, transfer process, or special conditions..."></textarea>
        </div>
    </div>

    <!-- Finance Calculator -->
    <div class="finance-calculator">
        <h4 style="color: #1e3a8a; margin-bottom: 15px;">💰 Total Cost Calculator</h4>
        <p style="color: #6b7280; margin-bottom: 15px;">
            This shows the buyer what they'll pay in total (your asking price + remaining finance)
        </p>
        
        <div class="calculator-result">
            <div style="margin-bottom: 10px;">
                <strong>Buyer's Total Investment:</strong>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; text-align: left; margin: 15px 0;">
                <div>
                    <small style="color: #6b7280;">Your asking price:</small><br>
                    <span id="display-asking-price">LKR 0</span>
                </div>
                <div>
                    <small style="color: #6b7280;">Remaining finance:</small><br>
                    <span id="display-outstanding">LKR 0</span>
                </div>
            </div>
            <hr style="margin: 15px 0; border: 1px solid #e5e7eb;">
            <div class="monthly-payment" id="total-investment">LKR 0</div>
            <small style="color: #6b7280;">Total Investment Required</small>
            
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb;">
                <div style="font-size: 1.1rem; color: #1e3a8a;">
                    <strong>Monthly Payment: <span id="display-monthly">LKR 0</span></strong>
                </div>
                <small style="color: #6b7280;">for <span id="display-months">0</span> months</small>
            </div>
        </div>
    </div>
</div>
                </div>

                      <!-- Step 4: Location -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;" fill="currentColor">
                                <rect width="256" height="256" fill="none"/>
                                <circle cx="128" cy="128" r="32" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <path d="M208,128c0,72-80,128-80,128s-80-56-80-128a80,80,0,0,1,160,0Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                            </svg>
                        </div>
                        Location
                    </h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="district">
                                District <span class="required">*</span>
                            </label>
                            <div class="searchable-dropdown" id="district-dropdown">
                                <input type="text" class="form-input searchable-input" id="district" 
                                       placeholder="Search or select district..." required autocomplete="off">
                                <div class="dropdown-arrow">
                                    <svg width="12" height="8" viewBox="0 0 12 8" fill="currentColor">
                                        <path d="M6 8L0 0h12L6 8z"/>
                                    </svg>
                                </div>
                                <div class="dropdown-options" id="district-options"></div>
                                <input type="hidden" id="district-value" name="district" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="city">
                                City/Town <span class="required">*</span>
                            </label>
                            <div class="searchable-dropdown" id="city-dropdown">
                                <input type="text" class="form-input searchable-input" id="city" 
                                       placeholder="First select a district..." disabled autocomplete="off">
                                <div class="dropdown-arrow">
                                    <svg width="12" height="8" viewBox="0 0 12 8" fill="currentColor">
                                        <path d="M6 8L0 0h12L6 8z"/>
                                    </svg>
                                </div>
                                <div class="dropdown-options" id="city-options"></div>
                                <input type="hidden" id="city-value" name="city" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Additional Features -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;" fill="currentColor">
                                <rect width="256" height="256" fill="none"/>
                                <circle cx="128" cy="128" r="40" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <path d="M41.43,178.09A99.14,99.14,0,0,1,31.36,153.8l16.78-21a81.59,81.59,0,0,1,0-9.64l-16.77-21a99.43,99.43,0,0,1,10.05-24.3l26.71-3a81,81,0,0,1,6.81-6.81l3-26.7A99.14,99.14,0,0,1,102.2,31.36l21,16.78a81.59,81.59,0,0,1,9.64,0l21-16.77a99.43,99.43,0,0,1,24.3,10.05l3,26.71a81,81,0,0,1,6.81,6.81l26.7,3a99.14,99.14,0,0,1,10.07,24.29l-16.78,21a81.59,81.59,0,0,1,0,9.64l16.77,21a99.43,99.43,0,0,1-10,24.3l-26.71,3a81,81,0,0,1-6.81,6.81l-3,26.7a99.14,99.14,0,0,1-24.29,10.07l-21-16.78a81.59,81.59,0,0,1-9.64,0l-21,16.77a99.43,99.43,0,0,1-24.3-10l-3-26.71a81,81,0,0,1-6.81-6.81Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                            </svg>
                         </div>
                        Additional Features
                    </h2>
                    
                    <div class="form-group full-width">
                        <label class="form-label">Safety Features</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="airbags" name="features[]" value="airbags">
                                <label for="airbags">Airbags</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="abs" name="features[]" value="abs">
                                <label for="abs">ABS</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="ebd" name="features[]" value="ebd">
                                <label for="ebd">EBD</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="stability-control" name="features[]" value="stability-control">
                                <label for="stability-control">Stability Control</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="lane-assist" name="features[]" value="lane-assist">
                                <label for="lane-assist">Lane Assist</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="collision-avoidance" name="features[]" value="collision-avoidance">
                                <label for="collision-avoidance">Collision Avoidance</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Comfort & Convenience</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="ac" name="features[]" value="ac">
                                <label for="ac">Air Conditioning</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="power-steering" name="features[]" value="power-steering">
                                <label for="power-steering">Power Steering</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="power-windows" name="features[]" value="power-windows">
                                <label for="power-windows">Power Windows</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="central-locking" name="features[]" value="central-locking">
                                <label for="central-locking">Central Locking</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="keyless-entry" name="features[]" value="keyless-entry">
                                <label for="keyless-entry">Keyless Entry</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="push-start" name="features[]" value="push-start">
                                <label for="push-start">Push Button Start</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="cruise-control" name="features[]" value="cruise-control">
                                <label for="cruise-control">Cruise Control</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="leather-seats" name="features[]" value="leather-seats">
                                <label for="leather-seats">Leather Seats</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group full-width">
                        <label class="form-label">Technology & Entertainment</label>
                        <div class="checkbox-group">
                            <div class="checkbox-item">
                                <input type="checkbox" id="touchscreen" name="features[]" value="touchscreen">
                                <label for="touchscreen">Touchscreen Display</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="bluetooth" name="features[]" value="bluetooth">
                                <label for="bluetooth">Bluetooth</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="usb" name="features[]" value="usb">
                                <label for="usb">USB Ports</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="navigation" name="features[]" value="navigation">
                                <label for="navigation">GPS Navigation</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="backup-camera" name="features[]" value="backup-camera">
                                <label for="backup-camera">Backup Camera</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="parking-sensors" name="features[]" value="parking-sensors">
                                <label for="parking-sensors">Parking Sensors</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="wireless-charging" name="features[]" value="wireless-charging">
                                <label for="wireless-charging">Wireless Charging</label>
                            </div>
                            <div class="checkbox-item">
                                <input type="checkbox" id="premium-audio" name="features[]" value="premium-audio">
                                <label for="premium-audio">Premium Audio System</label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 5: Photos -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;" fill="currentColor">
                                <rect width="256" height="256" fill="none"/>
                                <path d="M208,208H48a16,16,0,0,1-16-16V80A16,16,0,0,1,48,64H80L96,40h64l16,24h32a16,16,0,0,1,16,16V192A16,16,0,0,1,208,208Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <circle cx="128" cy="132" r="36" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                            </svg>
                         </div>
                        Vehicle Photos
                    </h2>
                    <p style="margin-bottom: 20px; color: #6b7280;">
                        Upload high-quality photos to attract more buyers. The first photo will be your main listing image.
                    </p>
                    
                    <div class="photo-upload-area" id="photo-upload">
                        <div class="upload-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;">
                                <rect width="256" height="256" fill="none"/>
                                <line x1="40" y1="128" x2="216" y2="128" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                <line x1="128" y1="40" x2="128" y2="216" fill="none" stroke="#000000" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                            </svg>
                        </div>
                        <div class="upload-text">Click to upload photos or drag and drop</div>
                        <div class="upload-hint">Supported formats: JPG, PNG (Max 5MB each, up to 15 photos)</div>
                        <input type="file" id="photo-input" multiple accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="photo-grid" id="photo-grid">
                        <!-- Photos will be displayed here -->
                    </div>
                </div>

                <!-- Step 6: Description -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;" fill="currentColor">
                                    <rect width="256" height="256" fill="none"/>
                                    <polygon points="128 160 96 160 96 128 192 32 224 64 128 160" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                    <line x1="168" y1="56" x2="200" y2="88" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                    <path d="M216,128v80a8,8,0,0,1-8,8H48a8,8,0,0,1-8-8V48a8,8,0,0,1,8-8h80" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                                </svg>
                        </div>
                        Vehicle Description
                    </h2>
                    
                    <div class="ai-description-container">
                        <!-- Header -->
                        <div class="ai-header">
                            <div class="ai-header-content">
                                <h2 class="ai-title">
                                    <div class="ai-icon">✨</div>
                                    AI Description Assistant
                                </h2>
                                <p class="ai-subtitle">Create compelling vehicle descriptions that sell</p>
                                
                                <div class="ai-status-bar">
                                    <div class="status-indicator"></div>
                                    <span class="status-text">Ready to help you write</span>
                                    <span class="ai-credit">3 generations remaining today</span>
                                </div>
                            </div>
                        </div>
                
                        <!-- Content -->
                        <div class="ai-content">
                            <!-- Initial State -->
                            <div id="initial-state">
                                <div style="text-align: center; padding: 40px 0;">
                                    <div style="font-size: 4rem; margin-bottom: 20px;">🚗</div>
                                    <h3 style="font-size: 1.5rem; margin-bottom: 12px; color: #1f2937;">Let's create your listing</h3>
                                    <p style="color: #6b7280; margin-bottom: 32px; max-width: 400px; margin-left: auto; margin-right: auto;">
                                        Based on your vehicle details, I'll write a professional description that highlights key features and attracts buyers
                                    </p>
                                    <button class="ai-btn ai-btn-primary" onclick="startGeneration()">
                                        <span>✨</span>
                                        <span>Generate Description</span>
                                    </button>
                                </div>
                            </div>
                
                            <!-- Loading State -->
                            <div id="loading-state" style="display: none;">
                                <div class="ai-loading">
                                    <div class="loading-animation">
                                        <div class="loading-ring"></div>
                                    </div>
                                    <p class="loading-text">Creating your description...</p>
                                    <p class="loading-subtitle">Analyzing vehicle details and market trends</p>
                                </div>
                            </div>
                
                            <!-- Editor State -->
                            <div id="editor-state" style="display: none;">
                                <!-- Writing Assistant -->
                                <div class="writing-assistant">
                                    <!-- Style Selector -->
                                    <div class="style-selector">
                                        <div class="style-option active" data-style="professional">
                                            <div class="style-name">Professional</div>
                                            <div class="style-desc">Clear, factual, business-like</div>
                                        </div>
                                        <div class="style-option" data-style="personal">
                                            <div class="style-name">Personal</div>
                                            <div class="style-desc">Friendly, story-driven</div>
                                        </div>
                                        <div class="style-option" data-style="detailed">
                                            <div class="style-name">Detailed</div>
                                            <div class="style-desc">Comprehensive specs</div>
                                        </div>
                                        <div class="style-option" data-style="urgent">
                                            <div class="style-name">Quick Sale</div>
                                            <div class="style-desc">Direct, urgent tone</div>
                                        </div>
                                    </div>
                
                                    <!-- Text Editor -->
                                    <div class="text-editor">
                                        <div class="editor-toolbar">
                                            <button class="toolbar-btn" onclick="formatText('bold')">
                                                <span style="font-weight: bold;">B</span>
                                            </button>
                                            <button class="toolbar-btn" onclick="formatText('italic')">
                                                <span style="font-style: italic;">I</span>
                                            </button>
                                            <div class="toolbar-separator"></div>
                                            <button class="toolbar-btn" onclick="insertTemplate('features')">
                                                <span>✓</span>
                                                <span>Add Features</span>
                                            </button>
                                            <button class="toolbar-btn" onclick="insertTemplate('history')">
                                                <span>📋</span>
                                                <span>Add History</span>
                                            </button>
                                        </div>
                                        <textarea class="editor-textarea" id="description" placeholder="Your AI-generated description will appear here..."></textarea>
                                        <div class="editor-footer">
                                            <div class="char-count">
                                                <span><span id="char-current">0</span>/1000</span>
                                                <div class="char-progress">
                                                    <div class="char-fill" id="char-fill" style="width: 0%"></div>
                                                </div>
                                            </div>
                                            <button class="toolbar-btn" onclick="copyToClipboard()">
                                                <span>📋</span>
                                                <span>Copy</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                
                                <!-- Quality Score -->
                                <div class="quality-panel">
                                    <div class="quality-header">
                                        <div class="quality-title">
                                            <span>📊</span>
                                            <span>Description Quality</span>
                                        </div>
                                        <div class="quality-badge" id="quality-score">85/100</div>
                                    </div>
                                    <div class="quality-bar-container">
                                        <div class="quality-bar">
                                            <div class="quality-marker" id="quality-marker" style="left: 85%"></div>
                                        </div>
                                    </div>
                                    <div class="improvement-tips" id="improvement-tips">
                                        <div class="tip" onclick="applyTip('history')">
                                            <div class="tip-icon">📋</div>
                                            <div class="tip-content">
                                                <div>Add service history details</div>
                                                <div class="tip-points">+8 points</div>
                                            </div>
                                        </div>
                                        <div class="tip" onclick="applyTip('photos')">
                                            <div class="tip-icon">📸</div>
                                            <div class="tip-content">
                                                <div>Mention photo availability</div>
                                                <div class="tip-points">+5 points</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                
                                <!-- Action Buttons -->
                                <div class="ai-actions">
                                    <button class="ai-btn ai-btn-secondary" onclick="regenerate()">
                                        <span>🔄</span>
                                        <span>Regenerate</span>
                                    </button>
                                    <button class="ai-btn ai-btn-secondary" onclick="enhance()">
                                        <span>✨</span>
                                        <span>Enhance</span>
                                    </button>
                                    <button class="ai-btn ai-btn-primary" onclick="acceptDescription()">
                                        <span>✓</span>
                                        <span>Use This Description</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 7: Contact Information -->
                <div class="form-section">
                    <h2 class="section-title">
                        <div class="section-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 256 256" style="width: 20px; height: 20px;" fill="currentColor">
                                <rect width="256" height="256" fill="none"/>
                                <path d="M164.39,145.34a8,8,0,0,1,7.59-.69l47.16,21.13a8,8,0,0,1,4.8,8.3A48.33,48.33,0,0,1,176,216,136,136,0,0,1,40,80,48.33,48.33,0,0,1,81.92,32.06a8,8,0,0,1,8.3,4.8l21.13,47.2a8,8,0,0,1-.66,7.53L89.32,117a7.93,7.93,0,0,0-.54,7.81c8.27,16.93,25.77,34.22,42.75,42.41a7.92,7.92,0,0,0,7.83-.59Z" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="16"/>
                            </svg>
                        </div>
                       Contact Information
                    </h2>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="contact-name">
                                Your Name <span class="required">*</span>
                            </label>
                            <input type="text" class="form-input" id="contact-name" placeholder="Full Name" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="contact-phone">
                                Phone Number <span class="required">*</span>
                            </label>
                            <input type="tel" class="form-input" id="contact-phone" placeholder="+94 77 123 4567" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="contact-email">
                                Email Address <span class="required">*</span>
                            </label>
                            <input type="email" class="form-input" id="contact-email" placeholder="your.email@example.com" required>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="whatsapp">
                                WhatsApp Number
                            </label>
                            <input type="tel" class="form-input" id="whatsapp" placeholder="+94 77 123 4567">
                            <div class="input-hint">Same as phone number if applicable</div>
                        </div>

                        <div class="form-group full-width">
                            <label class="form-label">Contact Preferences</label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="contact-phone-calls" name="contact-methods[]" value="phone-calls" checked>
                                    <label for="contact-phone-calls">Phone Calls</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="contact-whatsapp" name="contact-methods[]" value="whatsapp" checked>
                                    <label for="contact-whatsapp">WhatsApp Messages</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="contact-email-pref" name="contact-methods[]" value="email">
                                    <label for="contact-email-pref">Email</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="contact-site-messages" name="contact-methods[]" value="site-messages" checked>
                                    <label for="contact-site-messages">Messages through website</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Tips Card -->
            <div class="sidebar-card">
                <h3 class="sidebar-title">Tips for Better Sales</h3>
                <ul class="tips-list">
                    <li>Take photos in good lighting, preferably natural daylight</li>
                    <li>Clean your vehicle inside and out before photographing</li>
                    <li>Include photos of the engine, interior, and any damage</li>
                    <li>Write a detailed, honest description</li>
                    <li>Research similar vehicles to price competitively</li>
                    <li>Respond to inquiries promptly</li>
                    <li>Be honest about any issues or defects</li>
                    <li>Have all necessary documents ready</li>
                </ul>
            </div>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
            <button type="button" class="btn-secondary" id="save-draft">Save as Draft</button>
            <div>
                <button type="button" class="btn-secondary" id="preview-btn">Preview Listing</button>
                <button type="submit" class="btn-submit" id="submit-btn" form="post-ad-form">
                    Continue to Publish
                </button>
            </div>
        </div>

        <!-- Success Message (Hidden by default) -->
        <div class="success-message" id="success-message">
            <div class="success-icon">✅</div>
            <h2 class="success-title">Details Saved Successfully!</h2>
            <p class="success-text">
                Your vehicle details have been saved. You'll now be redirected to choose your listing plan and complete the publishing process.
            </p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <a href="#" class="btn-primary">Choose Listing Plan</a>
                <a href="#" class="btn-secondary">Edit Details</a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>AutoTrader.lk</h3>
                <p>Sri Lanka's most trusted vehicle marketplace. Find your perfect car, van, motorcycle or three-wheeler with confidence.</p>
            </div>
            
            <div class="footer-section">
                <h3>Quick Links</h3>
                <a href="#browse">Browse Cars</a>
                <a href="#sell">Sell Your Car</a>
                <a href="#finance">Car Finance</a>
                <a href="#insurance">Car Insurance</a>
            </div>
            
            <div class="footer-section">
                <h3>Support</h3>
                <a href="#help">Help Center</a>
                <a href="#contact">Contact Us</a>
                <a href="#terms">Terms & Conditions</a>
                <a href="#privacy">Privacy Policy</a>
            </div>
            
            <div class="footer-section">
                <h3>Contact Info</h3>
                <p>📞 +94 11 234 5678</p>
                <p>📧 info@autotrader.lk</p>
                <p>📍 Colombo, Sri Lanka</p>
            </div>
        </div>
        
        <div class="footer-bottom">
            <p>&copy; 2025 AutoTrader.lk. All rights reserved.</p>
        </div>
    </footer>

    <script>
        // Enhanced Progress Tracker Class with Fixed Logic
        class ProgressTracker {
            constructor() {
                this.currentStep = 1;
                this.steps = document.querySelectorAll('.step');
                this.stepStates = {
                    step1Complete: false,
                    step2PhotosComplete: false,
                    step2DescriptionComplete: false,
                    step3Complete: false
                };
                this.lastFeedbackMessage = null; // Track last feedback to prevent duplicates
                this.pendingAIDescription = false; // Track if AI description is generated but not accepted
                this.initializeStepTracking();
                
                console.log('✅ Enhanced Progress Tracker Initialized');
            }

            initializeStepTracking() {
                // Monitor form sections for completion
                this.monitorVehicleDetails();
                this.monitorPhotosAndDescription();
                this.monitorContactInfo();
            }

            // FIXED: Independent step completion logic
            updateStep(stepNumber = null, status = 'active') {
                // If no step number provided, determine current step based on completion states
                if (stepNumber === null) {
                    stepNumber = this.determineCurrentStep();
                }

                // Update each step based on its individual completion state
                for (let i = 0; i < this.steps.length; i++) {
                    const step = this.steps[i];
                    const stepNum = i + 1;
                    
                    // Remove all classes first
                    step.classList.remove('active', 'completed', 'inactive');
                    
                    // Determine step state based on completion and current step
                    if (this.isStepComplete(stepNum)) {
                        step.classList.add('completed');
                    } else if (stepNum === stepNumber) {
                        step.classList.add('active');
                    } else {
                        step.classList.add('inactive');
                    }
                }

                this.currentStep = stepNumber;
            }

            // FIXED: Determine current step based on completion states
            determineCurrentStep() {
                // FIXED: When step 3 is incomplete, it should be the current step (blue)
                // regardless of other steps' completion status
                if (!this.stepStates.step3Complete) {
                    // If step 3 is incomplete, check if prerequisites are met
                    if (this.stepStates.step1Complete && this.isStep2Complete()) {
                        return 3; // Prerequisites met, step 3 is current
                    } else if (this.stepStates.step1Complete && !this.isStep2Complete()) {
                        return 2; // Step 1 done, step 2 current
                    } else {
                        return 1; // Step 1 current
                    }
                } else {
                    // Step 3 is complete, check other incomplete steps
                    if (!this.stepStates.step1Complete) return 1;
                    if (!this.isStep2Complete()) return 2;
                    return 3; // All complete, stay on step 3
                }
            }

            // FIXED: Check if individual step is complete
            isStepComplete(stepNumber) {
                switch(stepNumber) {
                    case 1: return this.stepStates.step1Complete;
                    case 2: return this.isStep2Complete();
                    case 3: return this.stepStates.step3Complete;
                    default: return false;
                }
            }

            // Helper: Check if step 2 is complete (both photos and description)
            isStep2Complete() {
                return this.stepStates.step2PhotosComplete && this.stepStates.step2DescriptionComplete;
            }

            // Helper: Check if all steps are complete
            areAllStepsComplete() {
                return this.stepStates.step1Complete && 
                       this.isStep2Complete() && 
                       this.stepStates.step3Complete;
            }

            monitorVehicleDetails() {
                const regularRequiredFields = [
                    'make', 'model', 'year', 'mileage', 
                    'fuel-type', 'transmission', 'price', 'district', 'city'
                ];

                const financeRequiredFields = [
                    'finance-type', 'finance-provider', 'original-amount', 
                    'outstanding-amount', 'monthly-payment', 'remaining-months', 
                    'asking-price-finance'
                ];

                const allRequiredFields = [...regularRequiredFields, ...financeRequiredFields];

                const vehicleTypeCards = document.querySelectorAll('.vehicle-type');
                
                vehicleTypeCards.forEach(card => {
                    card.addEventListener('click', () => {
                        this.checkStep1Completion();
                    });
                });

                allRequiredFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('change', () => {
                            this.checkStep1Completion();
                        });
                        field.addEventListener('input', () => {
                            this.checkStep1Completion();
                        });
                    }
                });
            }

            checkStep1Completion() {
                const vehicleTypeSelected = document.querySelector('.vehicle-type.selected');
                const category = vehicleTypeSelected?.dataset.category;
                
                let allFieldsComplete = false;
                
                const isFinanceMode = document.getElementById('finance-toggle').checked;

if (isFinanceMode) {
    // Check basic vehicle fields + finance pricing fields
    const basicFields = ['make', 'model', 'year', 'mileage', 'fuel-type', 'transmission', 'district', 'city'];
    const financeFields = ['finance-type', 'finance-provider', 'original-amount', 'outstanding-amount', 'monthly-payment', 'remaining-months', 'asking-price-finance'];
    const allFields = [...basicFields, ...financeFields];
    
    allFieldsComplete = allFields.every(fieldId => {
        const field = document.getElementById(fieldId);
        return field && field.value.trim() !== '';
    });
} else {
    // Check basic vehicle fields + regular pricing fields
    const requiredFields = [
        'make', 'model', 'year', 'mileage', 
        'fuel-type', 'transmission', 'price', 'district', 'city'
    ];

    allFieldsComplete = requiredFields.every(fieldId => {
        const field = document.getElementById(fieldId);
        return field && field.value.trim() !== '';
    });
}

                const previousState = this.stepStates.step1Complete;
                this.stepStates.step1Complete = vehicleTypeSelected && allFieldsComplete;

                if (!previousState && this.stepStates.step1Complete) {
                    this.updateStep();
                    const message = category === 'finance' ? 'Finance details completed! ✅' : 'Vehicle details completed! ✅';
                    this.showStepFeedback(message);
                    this.checkOverallCompletion();
                } else if (previousState && !this.stepStates.step1Complete) {
                    this.updateStep();
                }
            }

            // FIXED: Enhanced photo and description monitoring
            monitorPhotosAndDescription() {
                // Monitor photo grid changes with improved logic
                const photoGrid = document.getElementById('photo-grid');
                if (photoGrid) {
                    const observer = new MutationObserver((mutations) => {
                        mutations.forEach((mutation) => {
                            if (mutation.type === 'childList') {
                                // Determine if this was an addition or removal
                                const wasAddition = mutation.addedNodes.length > 0;
                                const wasRemoval = mutation.removedNodes.length > 0;
                                
                                console.log('Photo change detected:', { wasAddition, wasRemoval });
                                this.checkPhotosState(wasAddition, wasRemoval);
                            }
                        });
                    });
                    observer.observe(photoGrid, { childList: true });
                }

                // Monitor description with improved logic
                const descriptionTextarea = document.getElementById('description');
                if (descriptionTextarea) {
                    descriptionTextarea.addEventListener('input', () => {
                        this.checkDescriptionState(false); // Manual typing
                    });
                }
            }

            monitorContactInfo() {
                const contactFields = ['contact-name', 'contact-phone', 'contact-email'];
                
                contactFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', () => {
                            this.checkStep3Completion();
                        });
                        field.addEventListener('change', () => {
                            this.checkStep3Completion();
                        });
                    }
                });
            }

            checkStep3Completion() {
                const contactName = document.getElementById('contact-name')?.value || '';
                const contactPhone = document.getElementById('contact-phone')?.value || '';
                const contactEmail = document.getElementById('contact-email')?.value || '';

                const previousState = this.stepStates.step3Complete;
                this.stepStates.step3Complete = contactName.trim() && contactPhone.trim() && contactEmail.trim();

                if (!previousState && this.stepStates.step3Complete) {
                    this.updateStep();
                    this.showStepFeedback('Contact information completed! ✅');
                    this.checkOverallCompletion();
                } else if (previousState && !this.stepStates.step3Complete) {
                    this.updateStep();
                }
            }

            // FIXED: Separate photo state checking with addition/removal context
            checkPhotosState(wasAddition = false, wasRemoval = false) {
                const photoCount = document.querySelectorAll('.photo-item').length;
                const previousPhotosState = this.stepStates.step2PhotosComplete;
                
                this.stepStates.step2PhotosComplete = photoCount > 0;
                
                console.log('Photos state check:', {
                    photoCount,
                    previousPhotosState,
                    currentPhotosState: this.stepStates.step2PhotosComplete,
                    wasAddition,
                    wasRemoval
                });

                // FIXED: Only trigger completion feedback when adding photos, never when removing
                if (wasAddition && this.stepStates.step2PhotosComplete && !previousPhotosState) {
                    // Photos were just added and this completes the photo requirement for the first time
                    this.checkStep2Completion('photo_added');
                } else if (wasRemoval && !this.stepStates.step2PhotosComplete) {
                    // All photos were removed, step 2 is no longer complete
                    this.handleStep2Incompletion();
                } else if (wasAddition && this.stepStates.step2PhotosComplete && previousPhotosState && this.stepStates.step2DescriptionComplete) {
                    // Adding more photos when requirements are already met - check completion silently
                    this.checkStep2Completion('state_check');
                }
                
                // Always update the step display regardless of feedback
                this.updateStep();
            }

            // FIXED: Separate description state checking with context
            checkDescriptionState(isAIGenerated = false, isAccepted = false) {
                const description = document.getElementById('description')?.value || '';
                const previousDescState = this.stepStates.step2DescriptionComplete;
                
                // FIXED: Only mark as complete if it's accepted (not just generated)
                if (isAIGenerated && !isAccepted) {
                    // AI description generated but not accepted - don't mark as complete yet
                    this.pendingAIDescription = true;
                    this.stepStates.step2DescriptionComplete = false;
                } else {
                    // Either manual description or accepted AI description
                    this.stepStates.step2DescriptionComplete = description.trim().length > 50;
                    this.pendingAIDescription = false;
                }
                
                console.log('Description state check:', {
                    descLength: description.length,
                    previousDescState,
                    currentDescState: this.stepStates.step2DescriptionComplete,
                    isAIGenerated,
                    isAccepted,
                    pendingAI: this.pendingAIDescription
                });

                // FIXED: Only trigger completion check when description is actually accepted or manually completed
                if (isAIGenerated && isAccepted && this.stepStates.step2DescriptionComplete) {
                    this.checkStep2Completion('ai_description');
                } else if (!previousDescState && this.stepStates.step2DescriptionComplete && !isAIGenerated) {
                    // Manual description completed
                    this.checkStep2Completion('manual_description');
                } else if (previousDescState && !this.stepStates.step2DescriptionComplete) {
                    // Description was cleared
                    this.handleStep2Incompletion();
                }

                this.updateStep(); // Use automatic step determination
            }

            // FIXED: Enhanced step 2 completion logic with context and duplicate prevention
            checkStep2Completion(context = 'unknown') {
                const hasPhotos = this.stepStates.step2PhotosComplete;
                const hasDescription = this.stepStates.step2DescriptionComplete;
                
                console.log('Step 2 completion check:', {
                    context,
                    hasPhotos,
                    hasDescription,
                    currentStep: this.currentStep
                });

                if (hasPhotos && hasDescription) {
                    // Construct feedback message based on context
                    let feedbackMessage = 'Photos and description added! ✅';
                    
                    if (context === 'ai_description') {
                        feedbackMessage = 'AI description accepted! Step 2 complete ✅';
                    } else if (context === 'photo_added') {
                        feedbackMessage = 'Photos and description completed! ✅';
                    }

                    // FIXED: Prevent duplicate feedback messages
                    if (this.lastFeedbackMessage !== feedbackMessage) {
                        this.showStepFeedback(feedbackMessage);
                        this.lastFeedbackMessage = feedbackMessage;
                    }
                    
                    // Update step display
                    this.updateStep();
                    
                    // Check if all steps are now complete
                    this.checkOverallCompletion();
                }
            }

            // FIXED: Handle step 2 incompletion
            handleStep2Incompletion() {
                this.updateStep(); // Use automatic step determination
                this.lastFeedbackMessage = null; // Reset feedback tracking
            }

            // FIXED: Overall completion check (separate from individual steps)
            checkOverallCompletion() {
                if (this.areAllStepsComplete()) {
                    // Only show "Ready to publish" when ALL steps are complete
                    setTimeout(() => {
                        this.showStepFeedback('Ready to publish! 🚀 All steps completed');
                    }, 500); // Slight delay to avoid overlapping with individual step feedback
                }
            }

            // FIXED: AI Description acceptance workflow
            handleAIDescriptionAcceptance() {
                const description = document.getElementById('description')?.value || '';
                if (description.trim().length > 50) {
                    this.checkDescriptionState(true, true); // AI-generated and accepted
                }
            }

            // FIXED: AI Description generation (no immediate feedback)
            handleAIDescriptionGeneration() {
                const description = document.getElementById('description')?.value || '';
                if (description.trim().length > 50) {
                    this.checkDescriptionState(true, false); // AI-generated but not accepted
                }
            }

            showStepFeedback(message) {
                // Remove existing feedback
                const existing = document.querySelector('.step-feedback');
                if (existing) existing.remove();

                const feedback = document.createElement('div');
                feedback.className = 'step-feedback';
                feedback.textContent = message;
                feedback.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: #10b981;
                    color: white;
                    padding: 12px 20px;
                    border-radius: 8px;
                    font-weight: 600;
                    z-index: 1000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                    animation: slideInRight 0.3s ease-out;
                `;

                document.body.appendChild(feedback);

                // Remove after 3 seconds
                setTimeout(() => {
                    feedback.style.animation = 'slideOutRight 0.3s ease-in';
                    setTimeout(() => feedback.remove(), 300);
                }, 3000);

                console.log('Feedback shown:', message);
            }
        }

        // Enhanced vehicle type selection with finance handling
        document.querySelectorAll('.vehicle-type').forEach(type => {
            // Add accessibility attributes
            type.setAttribute('tabindex', '0');
            type.setAttribute('role', 'button');
            
            // Click event handler
            type.addEventListener('click', function() {
                // Remove selected class from all types
                document.querySelectorAll('.vehicle-type').forEach(t => t.classList.remove('selected'));
                
                // Add selected class to clicked type
                this.classList.add('selected');
                
                // Get vehicle type and name
                const vehicleType = this.dataset.type;
                const vehicleName = this.querySelector('.vehicle-type-name').textContent;
                const category = this.dataset.category;
                
                // Update display
                document.getElementById('selected-display').textContent = `Selected: ${vehicleName}`;
                
                console.log('Selected vehicle type:', vehicleType, 'Category:', category);
                // Update form fields based on vehicle type
                updateFormForVehicleType(vehicleType);

                // Check if bicycle is selected and disable/enable finance toggle
                handleFinanceToggleAvailability(vehicleType);
            });
            
            // Keyboard support for accessibility
            type.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            });
        });

        // Finance section handling
        function handleFinanceToggleAvailability(vehicleType) {
    const financeToggle = document.querySelector('.finance-toggle');
    const financeToggleInput = document.getElementById('finance-toggle');
    
    if (vehicleType === 'bicycle') {
        financeToggle.classList.add('disabled');
        financeToggleInput.disabled = true;
        financeToggleInput.checked = false;
        hideFinancePricing();
    } else {
        financeToggle.classList.remove('disabled');
        financeToggleInput.disabled = false;
    }
}

function showFinancePricing() {
    document.getElementById('regular-pricing').style.display = 'none';
    document.getElementById('finance-pricing').style.display = 'block';
    setupFinanceCalculator();
}
function hideFinancePricing() {
    document.getElementById('regular-pricing').style.display = 'block';
    document.getElementById('finance-pricing').style.display = 'none';
}

        function setupFinanceCalculator() {
            const askingPriceField = document.getElementById('asking-price-finance');
            const outstandingField = document.getElementById('outstanding-amount');
            const monthlyField = document.getElementById('monthly-payment');
            const monthsField = document.getElementById('remaining-months');

            [askingPriceField, outstandingField, monthlyField, monthsField].forEach(field => {
                if (field) {
                    field.addEventListener('input', updateFinanceCalculator);
                }
            });
        }

        function updateFinanceCalculator() {
            const askingPrice = parseFloat(document.getElementById('asking-price-finance')?.value || 0);
            const outstanding = parseFloat(document.getElementById('outstanding-amount')?.value || 0);
            const monthly = parseFloat(document.getElementById('monthly-payment')?.value || 0);
            const months = parseFloat(document.getElementById('remaining-months')?.value || 0);

            // Update display
            document.getElementById('display-asking-price').textContent = 
                `LKR ${askingPrice.toLocaleString()}`;
            document.getElementById('display-outstanding').textContent = 
                `LKR ${outstanding.toLocaleString()}`;
            document.getElementById('display-monthly').textContent = 
                `LKR ${monthly.toLocaleString()}`;
            document.getElementById('display-months').textContent = months;

            // Calculate total investment
            const totalInvestment = askingPrice + outstanding;
            document.getElementById('total-investment').textContent = 
                `LKR ${totalInvestment.toLocaleString()}`;
        }

        // Make-Model dependency
        const makeModelMap = {
            toyota: ['Prius', 'Corolla', 'Camry', 'Aqua', 'Vitz', 'Allion', 'Premio', 'Axio', 'Yaris', 'Hilux'],
            honda: ['Civic', 'Accord', 'Fit', 'Vezel', 'CR-V', 'Insight', 'City', 'Jazz', 'Pilot', 'Ridgeline'],
            nissan: ['March', 'Tiida', 'Sylphy', 'Teana', 'X-Trail', 'Murano', 'Navara', 'Juke', 'Qashqai', 'Leaf'],
            mazda: ['Demio', 'Axela', 'Atenza', 'CX-3', 'CX-5', 'CX-9', 'BT-50', 'Premacy', 'Biante', 'Roadster'],
            suzuki: ['Alto', 'Swift', 'Wagon R', 'Baleno', 'Vitara', 'Jimny', 'Ertiga', 'S-Cross', 'Ignis', 'Ciaz'],
            mitsubishi: ['Lancer', 'Outlander', 'Pajero', 'Montero', 'ASX', 'Mirage', 'Triton', 'Galant', 'Colt', 'Eclipse'],
            hyundai: ['Elantra', 'Sonata', 'Tucson', 'Santa Fe', 'i10', 'i20', 'i30', 'Accent', 'Genesis', 'Kona'],
            kia: ['Cerato', 'Optima', 'Sportage', 'Sorento', 'Picanto', 'Rio', 'Soul', 'Stinger', 'Carnival', 'Seltos'],
            bmw: ['3 Series', '5 Series', '7 Series', 'X1', 'X3', 'X5', 'X7', 'Z4', 'i3', 'i8'],
            mercedes: ['C-Class', 'E-Class', 'S-Class', 'A-Class', 'GLA', 'GLC', 'GLE', 'GLS', 'CLA', 'CLS'],
            audi: ['A3', 'A4', 'A6', 'A8', 'Q3', 'Q5', 'Q7', 'Q8', 'TT', 'R8']
        };

        document.getElementById('make').addEventListener('change', function() {
            const make = this.value;
            const modelSelect = document.getElementById('model');
            
            modelSelect.innerHTML = '<option value="">Select Model</option>';
            
            if (make && makeModelMap[make]) {
                modelSelect.disabled = false;
                makeModelMap[make].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.toLowerCase().replace(/\s+/g, '-');
                    option.textContent = model;
                    modelSelect.appendChild(option);
                });
            } else if (make === 'other') {
                modelSelect.disabled = false;
                const option = document.createElement('option');
                option.value = 'other';
                option.textContent = 'Other';
                modelSelect.appendChild(option);
            } else {
                modelSelect.disabled = true;
            }
        });

        // Generate year options
        const yearSelect = document.getElementById('year');
        const currentYear = new Date().getFullYear();
        for (let year = currentYear; year >= 1990; year--) {
            const option = document.createElement('option');
            option.value = year;
            option.textContent = year;
            yearSelect.appendChild(option);
        }

        // Photo upload functionality
        const photoUpload = document.getElementById('photo-upload');
        const photoInput = document.getElementById('photo-input');
        const photoGrid = document.getElementById('photo-grid');
        let uploadedPhotos = [];

        photoUpload.addEventListener('click', () => photoInput.click());
        
        photoUpload.addEventListener('dragover', (e) => {
            e.preventDefault();
            photoUpload.classList.add('dragover');
        });

        photoUpload.addEventListener('dragleave', () => {
            photoUpload.classList.remove('dragover');
        });

        photoUpload.addEventListener('drop', (e) => {
            e.preventDefault();
            photoUpload.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        photoInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/') && uploadedPhotos.length < 15) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        addPhotoToGrid(e.target.result, file.name);
                    };
                    reader.readAsDataURL(file);
                    uploadedPhotos.push(file);
                }
            });
            updatePhotoUploadText();
        }

        function addPhotoToGrid(src, name) {
            const photoItem = document.createElement('div');
            photoItem.className = 'photo-item';
            
            const isMain = photoGrid.children.length === 0;
            
            photoItem.innerHTML = `
                <img src="${src}" alt="${name}" class="photo-preview">
                <button type="button" class="photo-remove" onclick="removePhoto(this)">×</button>
                ${isMain ? '<div class="photo-main-indicator">Main Photo</div>' : ''}
            `;
            
            photoGrid.appendChild(photoItem);
        }

        function removePhoto(button) {
            const photoItem = button.parentElement;
            const index = Array.from(photoGrid.children).indexOf(photoItem);
            
            uploadedPhotos.splice(index, 1);
            photoItem.remove();
            
            if (photoGrid.children.length > 0) {
                const firstPhoto = photoGrid.children[0];
                const existingIndicator = firstPhoto.querySelector('.photo-main-indicator');
                if (!existingIndicator) {
                    const indicator = document.createElement('div');
                    indicator.className = 'photo-main-indicator';
                    indicator.textContent = 'Main Photo';
                    firstPhoto.appendChild(indicator);
                }
            }
            
            updatePhotoUploadText();
        }

        function updatePhotoUploadText() {
            const uploadText = photoUpload.querySelector('.upload-text');
            const uploadHint = photoUpload.querySelector('.upload-hint');
            
            if (uploadedPhotos.length === 0) {
                uploadText.textContent = 'Click to upload photos or drag and drop';
                uploadHint.textContent = 'Supported formats: JPG, PNG (Max 5MB each, up to 15 photos)';
            } else {
                uploadText.textContent = `${uploadedPhotos.length} photo(s) uploaded`;
                uploadHint.textContent = `You can upload ${15 - uploadedPhotos.length} more photos`;
            }
        }

        function updateFormForVehicleType(type) {
            const engineCapacityGroup = document.getElementById('engine-capacity').closest('.form-group');
            
            if (type === 'three-wheeler') {
                engineCapacityGroup.style.display = 'none';
            } else {
                engineCapacityGroup.style.display = 'flex';
            }
        }

        // Form validation and submission
document.getElementById('post-ad-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Clean up inactive mode data before validation
    const isFinanceMode = document.getElementById('finance-toggle').checked;
    
    if (isFinanceMode) {
        // Clear regular pricing fields when in finance mode
        document.getElementById('price').value = '';
        document.getElementById('negotiable').checked = false;
        console.log('Finance mode: Cleared regular pricing fields');
    } else {
        // Clear finance fields when in regular mode
        const financeFieldIds = [
            'finance-type', 'finance-provider', 'original-amount', 
            'outstanding-amount', 'monthly-payment', 'remaining-months', 
            'asking-price-finance', 'interest-rate', 'next-payment-date', 
            'finance-notes'
        ];
        
        financeFieldIds.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.value = '';
            }
        });

        // Also clear the finance negotiable checkbox
        document.getElementById('finance-negotiable').checked = false;

        // Clear finance checkboxes
        const financeCheckboxes = document.querySelectorAll('#finance-pricing input[type="checkbox"]');
        financeCheckboxes.forEach(checkbox => {
            checkbox.checked = false;
        });
        
        console.log('Regular mode: Cleared finance fields');
    }
    
    // Continue with existing validation logic
    const requiredFields = this.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        // Only validate visible required fields
        const isFieldVisible = field.offsetParent !== null;
        if (isFieldVisible && !field.value.trim()) {
            field.style.borderColor = '#ef4444';
            isValid = false;
        } else {
            field.style.borderColor = '#d1d5db';
        }
    });

    const selectedVehicleType = document.querySelector('.vehicle-type.selected');
    if (!selectedVehicleType) {
        alert('Please select a vehicle type');
        isValid = false;
    }

    if (uploadedPhotos.length === 0) {
        alert('Please upload at least one photo of your vehicle');
        isValid = false;
    }

    if (isValid) {
        const submitBtn = document.getElementById('submit-btn');
        const originalText = submitBtn.textContent;
        submitBtn.textContent = 'Saving details...';
        submitBtn.disabled = true;

        // Log the final form data for debugging
        const formData = new FormData(this);
        console.log('Final form data being submitted:');
        for (let [key, value] of formData.entries()) {
            if (value) { // Only log non-empty values
                console.log(`${key}: ${value}`);
            }
        }

        setTimeout(() => {
            document.querySelector('.main-container').style.display = 'none';
            document.getElementById('success-message').style.display = 'block';
            window.scrollTo(0, 0);
        }, 2000);
    }
});
        // Save as draft functionality
        document.getElementById('save-draft').addEventListener('click', function() {
            alert('Draft saved successfully! You can continue editing later.');
        });

        // Preview functionality
        document.getElementById('preview-btn').addEventListener('click', function() {
            alert('Preview functionality will open in a new window');
        });

        // AI Description Generator JavaScript
        let currentStyle = 'professional';
        let generationCount = 3;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            window.progressTracker = new ProgressTracker();
            
            document.querySelectorAll('.style-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.style-option').forEach(o => o.classList.remove('active'));
                    this.classList.add('active');
                    currentStyle = this.dataset.style;
                    regenerate();
                });
            });

            const textarea = document.getElementById('description');
            textarea.addEventListener('input', updateCharCount);
        });

        // Add this after the existing event listeners
document.getElementById('finance-toggle').addEventListener('change', function() {
    if (this.checked) {
        showFinancePricing();
        console.log('Finance mode enabled');
    } else {document.getElementById('finance-toggle').addEventListener('change', function() {
    if (this.checked) {
        showFinancePricing();
        console.log('Finance mode enabled');
    } else {
        hideFinancePricing();
        console.log('Regular pricing mode');
    }
    
    // Add this line to fix the progress tracking
    window.progressTracker.checkStep1Completion();
});
        hideFinancePricing();
        console.log('Regular pricing mode');
    }
});

        function startGeneration() {
            if (generationCount <= 0) {
                alert('You have used all your free generations for today. Upgrade to Pro for unlimited generations!');
                return;
            }

            document.getElementById('initial-state').style.display = 'none';
            document.getElementById('loading-state').style.display = 'block';

            setTimeout(() => {
                document.getElementById('loading-state').style.display = 'none';
                document.getElementById('editor-state').style.display = 'block';
                generateDescription();
                generationCount--;
                updateStatus();
            }, 2000);
        }

        function generateDescription() {
            const descriptions = {
                professional: "Well-maintained 2020 Toyota Prius in excellent condition with 45,000km on the odometer. This hybrid vehicle features automatic transmission, comprehensive safety package, and modern technology features. Vehicle is in pristine condition with minimal wear. Multiple photos available for detailed inspection. Contact for viewing arrangements and more details.",
                personal: "I'm selling my beloved 2020 Toyota Prius with 45,000km. It's got automatic transmission, runs on hybrid, and has been my reliable companion for daily commutes. The car has all the modern safety features and tech you'd expect. Upgrading to a newer model. Feel free to reach out for a test drive!",
                detailed: "Comprehensive listing for this 2020 Toyota Prius with 45,000km documented mileage. Specifications include hybrid engine, automatic transmission, comprehensive safety package including ABS, airbags, and stability control. Interior features include climate control, touchscreen infotainment, and premium upholstery. Complete service history available. Priced competitively for quick sale.",
                urgent: "Quick sale needed! 2020 Toyota Prius with 45,000km. Hybrid, automatic. Excellent condition, well-maintained, all features working perfectly. Priced to sell quickly. Serious buyers only. Contact immediately for best deal!"
            };

            document.getElementById('description').value = descriptions[currentStyle];
            updateCharCount();
            updateQualityScore();
            
            // FIXED: Handle AI description generation (no immediate feedback)
            window.progressTracker.handleAIDescriptionGeneration();
        }

        function regenerate() {
            const textarea = document.getElementById('description');
            textarea.style.opacity = '0.5';
            
            setTimeout(() => {
                generateDescription();
                textarea.style.opacity = '1';
                textarea.classList.add('fade-in');
            }, 500);
        }

        function enhance() {
            const textarea = document.getElementById('description');
            let text = textarea.value;
            
            if (!text.includes('viewing')) {
                text += ' Available for viewing by appointment.';
            }
            if (!text.includes('negotiable')) {
                text += ' Price negotiable for serious buyers.';
            }
            
            textarea.value = text;
            updateCharCount();
            updateQualityScore();
        }

        function updateCharCount() {
            const textarea = document.getElementById('description');
            const count = textarea.value.length;
            const percentage = (count / 1000) * 100;
            
            document.getElementById('char-current').textContent = count;
            document.getElementById('char-fill').style.width = `${Math.min(percentage, 100)}%`;
            
            const fill = document.getElementById('char-fill');
            if (count > 900) {
                fill.style.background = '#ef4444';
            } else if (count > 700) {
                fill.style.background = '#f59e0b';
            } else {
                fill.style.background = '#667eea';
            }
        }

        function updateQualityScore() {
            const text = document.getElementById('description').value;
            let score = 50;

            if (text.length > 200) score += 15;
            if (text.length > 300) score += 10;
            if (text.includes('condition')) score += 8;
            if (text.includes('service') || text.includes('maintenance')) score += 10;
            if (text.includes('viewing')) score += 7;
            if (text.includes('contact')) score += 5;

            score = Math.min(100, score);
            
            document.getElementById('quality-score').textContent = `${score}/100`;
            document.getElementById('quality-marker').style.left = `${score}%`;

            updateImprovementTips(text, score);
        }

        function updateImprovementTips(text, score) {
            const tips = [];
            
            if (!text.includes('service') && !text.includes('maintenance')) {
                tips.push({
                    type: 'history',
                    text: 'Add service history details',
                    points: 10
                });
            }
            if (!text.includes('photos') && !text.includes('viewing')) {
                tips.push({
                    type: 'photos',
                    text: 'Mention photo availability',
                    points: 7
                });
            }
            if (!text.includes('condition')) {
                tips.push({
                    type: 'condition',
                    text: 'Describe vehicle condition',
                    points: 8
                });
            }

            const tipsContainer = document.getElementById('improvement-tips');
            tipsContainer.innerHTML = tips.slice(0, 2).map(tip => `
                <div class="tip" onclick="applyTip('${tip.type}')">
                    <div class="tip-icon">${tip.type === 'history' ? '📋' : tip.type === 'photos' ? '📸' : '⭐'}</div>
                    <div class="tip-content">
                        <div>${tip.text}</div>
                        <div class="tip-points">+${tip.points} points</div>
                    </div>
                </div>
            `).join('');
        }

        function applyTip(type) {
            const textarea = document.getElementById('description');
            let text = textarea.value;

            const additions = {
                history: '\n\nFull service history available with all maintenance records.',
                photos: '\n\nDetailed photos available showing all angles and features.',
                condition: '\n\nVehicle is in excellent condition with minimal wear.'
            };

            if (additions[type]) {
                textarea.value = text + additions[type];
                updateCharCount();
                updateQualityScore();
            }
        }

        function insertTemplate(type) {
            const textarea = document.getElementById('description');
            const templates = {
                features: '\n\nKey Features:\n• Air conditioning\n• Power steering\n• Central locking\n• Alloy wheels',
                history: '\n\nService History:\n• Regular maintenance at authorized dealer\n• Recent service completed\n• All records available'
            };

            if (templates[type]) {
                const cursorPos = textarea.selectionStart;
                const textBefore = textarea.value.substring(0, cursorPos);
                const textAfter = textarea.value.substring(cursorPos);
                textarea.value = textBefore + templates[type] + textAfter;
                updateCharCount();
                updateQualityScore();
            }
        }

        function formatText(format) {
            console.log('Format:', format);
        }

        function copyToClipboard() {
            const textarea = document.getElementById('description');
            textarea.select();
            document.execCommand('copy');
            
            const btn = event.target.closest('.toolbar-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<span>✓</span><span>Copied!</span>';
            setTimeout(() => {
                btn.innerHTML = originalText;
            }, 2000);
        }

        function acceptDescription() {
            // FIXED: Simulate the AI description acceptance workflow (triggers feedback)
            window.progressTracker.handleAIDescriptionAcceptance();
            alert('Description saved! You can continue editing in the main form.');
        }

        function updateStatus() {
            const statusText = document.querySelector('.status-text');
            const creditText = document.querySelector('.ai-credit');
            
            if (generationCount > 0) {
                statusText.textContent = 'Ready to help you write';
                creditText.textContent = `${generationCount} generations remaining today`;
            } else {
                statusText.textContent = 'Daily limit reached';
                creditText.textContent = 'Upgrade to Pro for unlimited';
                document.querySelector('.status-indicator').style.background = '#ef4444';
            }
        }

        // Auto-save functionality
        setInterval(() => {
            const formData = new FormData(document.getElementById('post-ad-form'));
            console.log('Auto-saving draft...');
        }, 30000);

        // Location Data Loader with Sri Lankan data
        class LocationDataLoader {
            constructor() {
                this.districts = [];
                this.cities = {};
                this.loaded = false;
            }

            async loadData() {
                if (this.loaded) return;

                try {
                    console.log('📍 Loading location data...');
                    
                    // Try to load from your JSON files first
                    try {
                        const districtsResponse = await fetch('./data/districts.json');
                        this.districts = await districtsResponse.json();
                        
                        const citiesResponse = await fetch('./data/cities.json');
                        this.cities = await citiesResponse.json();
                        
                        console.log(`✅ Loaded ${this.districts.length} districts and cities for ${Object.keys(this.cities).length} districts from JSON files`);
                    } catch (jsonError) {
                        console.log('JSON files not found, using fallback data...');
                        this.loadFallbackData();
                    }
                    
                    this.loaded = true;
                    
                } catch (error) {
                    console.error('❌ Error loading location data:', error);
                    this.loadFallbackData();
                }
            }

            loadFallbackData() {
                console.log('🔄 Loading comprehensive fallback data...');
                
                // Complete Sri Lankan districts data
                this.districts = [
                    { id: 1, name: "Ampara", province: "Eastern" },
                    { id: 2, name: "Anuradhapura", province: "North Central" },
                    { id: 3, name: "Badulla", province: "Uva" },
                    { id: 4, name: "Batticaloa", province: "Eastern" },
                    { id: 5, name: "Colombo", province: "Western" },
                    { id: 6, name: "Galle", province: "Southern" },
                    { id: 7, name: "Gampaha", province: "Western" },
                    { id: 8, name: "Hambantota", province: "Southern" },
                    { id: 9, name: "Jaffna", province: "Northern" },
                    { id: 10, name: "Kalutara", province: "Western" },
                    { id: 11, name: "Kandy", province: "Central" },
                    { id: 12, name: "Kegalle", province: "Sabaragamuwa" },
                    { id: 13, name: "Kilinochchi", province: "Northern" },
                    { id: 14, name: "Kurunegala", province: "North Western" },
                    { id: 15, name: "Mannar", province: "Northern" },
                    { id: 16, name: "Matale", province: "Central" },
                    { id: 17, name: "Matara", province: "Southern" },
                    { id: 18, name: "Monaragala", province: "Uva" },
                    { id: 19, name: "Mullaitivu", province: "Northern" },
                    { id: 20, name: "Nuwara Eliya", province: "Central" },
                    { id: 21, name: "Polonnaruwa", province: "North Central" },
                    { id: 22, name: "Puttalam", province: "North Western" },
                    { id: 23, name: "Ratnapura", province: "Sabaragamuwa" },
                    { id: 24, name: "Trincomalee", province: "Eastern" },
                    { id: 25, name: "Vavuniya", province: "Northern" }
                ];

                // Comprehensive cities data by district ID
                this.cities = {
                    "1": [
                        { id: 1, name: "Akkaraipattu", district_id: 1 },
                        { id: 2, name: "Ampara", district_id: 1 },
                        { id: 3, name: "Kalmunai", district_id: 1 },
                        { id: 4, name: "Sainthamaruthu", district_id: 1 },
                        { id: 5, name: "Sammanthurai", district_id: 1 },
                        { id: 6, name: "Tirukkovil", district_id: 1 },
                        { id: 7, name: "Uhana", district_id: 1 }
                    ],
                    "2": [
                        { id: 8, name: "Anuradhapura", district_id: 2 },
                        { id: 9, name: "Kekirawa", district_id: 2 },
                        { id: 10, name: "Thambuttegama", district_id: 2 },
                        { id: 11, name: "Eppawala", district_id: 2 },
                        { id: 12, name: "Galnewa", district_id: 2 },
                        { id: 13, name: "Horowpothana", district_id: 2 },
                        { id: 14, name: "Medawachchiya", district_id: 2 }
                    ],
                    "3": [
                        { id: 15, name: "Badulla", district_id: 3 },
                        { id: 16, name: "Bandarawela", district_id: 3 },
                        { id: 17, name: "Ella", district_id: 3 },
                        { id: 18, name: "Haputale", district_id: 3 },
                        { id: 19, name: "Mahiyanganaya", district_id: 3 },
                        { id: 20, name: "Passara", district_id: 3 },
                        { id: 21, name: "Welimada", district_id: 3 }
                    ],
                    "4": [
                        { id: 22, name: "Batticaloa", district_id: 4 },
                        { id: 23, name: "Eravur", district_id: 4 },
                        { id: 24, name: "Kattankudy", district_id: 4 },
                        { id: 25, name: "Vakarai", district_id: 4 },
                        { id: 26, name: "Valachchenai", district_id: 4 },
                        { id: 27, name: "Kaluwanchikudy", district_id: 4 },
                        { id: 28, name: "Oddamavadi", district_id: 4 }
                    ],
                    "5": [
                        { id: 29, name: "Colombo", district_id: 5 },
                        { id: 30, name: "Dehiwala-Mount Lavinia", district_id: 5 },
                        { id: 31, name: "Moratuwa", district_id: 5 },
                        { id: 32, name: "Sri Jayawardenepura Kotte", district_id: 5 },
                        { id: 33, name: "Kolonnawa", district_id: 5 },
                        { id: 34, name: "Kaduwela", district_id: 5 },
                        { id: 35, name: "Kotikawatta", district_id: 5 },
                        { id: 36, name: "Maharagama", district_id: 5 },
                        { id: 37, name: "Nugegoda", district_id: 5 },
                        { id: 38, name: "Rajagiriya", district_id: 5 }
                    ],
                    "6": [
                        { id: 39, name: "Galle", district_id: 6 },
                        { id: 40, name: "Ambalangoda", district_id: 6 },
                        { id: 41, name: "Baddegama", district_id: 6 },
                        { id: 42, name: "Bentota", district_id: 6 },
                        { id: 43, name: "Elpitiya", district_id: 6 },
                        { id: 44, name: "Hikkaduwa", district_id: 6 },
                        { id: 45, name: "Unawatuna", district_id: 6 }
                    ],
                    "7": [
                        { id: 46, name: "Gampaha", district_id: 7 },
                        { id: 47, name: "Negombo", district_id: 7 },
                        { id: 48, name: "Katunayake", district_id: 7 },
                        { id: 49, name: "Ja-Ela", district_id: 7 },
                        { id: 50, name: "Wattala", district_id: 7 },
                        { id: 51, name: "Kelaniya", district_id: 7 },
                        { id: 52, name: "Ragama", district_id: 7 },
                        { id: 53, name: "Minuwangoda", district_id: 7 },
                        { id: 54, name: "Divulapitiya", district_id: 7 }
                    ],
                    "8": [
                        { id: 55, name: "Hambantota", district_id: 8 },
                        { id: 56, name: "Tangalle", district_id: 8 },
                        { id: 57, name: "Tissamaharama", district_id: 8 },
                        { id: 58, name: "Ambalantota", district_id: 8 },
                        { id: 59, name: "Beliatta", district_id: 8 },
                        { id: 60, name: "Suriyawewa", district_id: 8 },
                        { id: 61, name: "Weeraketiya", district_id: 8 }
                    ],
                    "9": [
                        { id: 62, name: "Jaffna", district_id: 9 },
                        { id: 63, name: "Chavakachcheri", district_id: 9 },
                        { id: 64, name: "Point Pedro", district_id: 9 },
                        { id: 65, name: "Karainagar", district_id: 9 },
                        { id: 66, name: "Velanai", district_id: 9 },
                        { id: 67, name: "Kayts", district_id: 9 },
                        { id: 68, name: "Nelliady", district_id: 9 }
                    ],
                    "10": [
                        { id: 69, name: "Kalutara", district_id: 10 },
                        { id: 70, name: "Panadura", district_id: 10 },
                        { id: 71, name: "Horana", district_id: 10 },
                        { id: 72, name: "Beruwala", district_id: 10 },
                        { id: 73, name: "Aluthgama", district_id: 10 },
                        { id: 74, name: "Mathugama", district_id: 10 },
                        { id: 75, name: "Bandaragama", district_id: 10 }
                    ],
                    "11": [
                        { id: 76, name: "Kandy", district_id: 11 },
                        { id: 77, name: "Gampola", district_id: 11 },
                        { id: 78, name: "Nawalapitiya", district_id: 11 },
                        { id: 79, name: "Wattegama", district_id: 11 },
                        { id: 80, name: "Kadugannawa", district_id: 11 },
                        { id: 81, name: "Peradeniya", district_id: 11 },
                        { id: 82, name: "Katugastota", district_id: 11 }
                    ],
                    "12": [
                        { id: 83, name: "Kegalle", district_id: 12 },
                        { id: 84, name: "Mawanella", district_id: 12 },
                        { id: 85, name: "Warakapola", district_id: 12 },
                        { id: 86, name: "Rambukkana", district_id: 12 },
                        { id: 87, name: "Galigamuwa", district_id: 12 },
                        { id: 88, name: "Dehiowita", district_id: 12 },
                        { id: 89, name: "Yatiyantota", district_id: 12 }
                    ],
                    "13": [
                        { id: 90, name: "Kilinochchi", district_id: 13 },
                        { id: 91, name: "Pallai", district_id: 13 },
                        { id: 92, name: "Paranthan", district_id: 13 },
                        { id: 93, name: "Poonakary", district_id: 13 },
                        { id: 94, name: "Elephant Pass", district_id: 13 },
                        { id: 95, name: "Kandavalai", district_id: 13 }
                    ],
                    "14": [
                        { id: 96, name: "Kurunegala", district_id: 14 },
                        { id: 97, name: "Chilaw", district_id: 14 },
                        { id: 98, name: "Kuliyapitiya", district_id: 14 },
                        { id: 99, name: "Narammala", district_id: 14 },
                        { id: 100, name: "Wariyapola", district_id: 14 },
                        { id: 101, name: "Pannala", district_id: 14 },
                        { id: 102, name: "Melsiripura", district_id: 14 }
                    ],
                    "15": [
                        { id: 103, name: "Mannar", district_id: 15 },
                        { id: 104, name: "Nanattan", district_id: 15 },
                        { id: 105, name: "Madhu", district_id: 15 },
                        { id: 106, name: "Pesalai", district_id: 15 },
                        { id: 107, name: "Adampan", district_id: 15 },
                        { id: 108, name: "Silavathurai", district_id: 15 }
                    ],
                    "16": [
                        { id: 109, name: "Matale", district_id: 16 },
                        { id: 110, name: "Dambulla", district_id: 16 },
                        { id: 111, name: "Sigiriya", district_id: 16 },
                        { id: 112, name: "Galewela", district_id: 16 },
                        { id: 113, name: "Ukuwela", district_id: 16 },
                        { id: 114, name: "Naula", district_id: 16 },
                        { id: 115, name: "Rattota", district_id: 16 }
                    ],
                    "17": [
                        { id: 116, name: "Matara", district_id: 17 },
                        { id: 117, name: "Weligama", district_id: 17 },
                        { id: 118, name: "Mirissa", district_id: 17 },
                        { id: 119, name: "Akuressa", district_id: 17 },
                        { id: 120, name: "Hakmana", district_id: 17 },
                        { id: 121, name: "Dikwella", district_id: 17 },
                        { id: 122, name: "Devinuwara", district_id: 17 }
                    ],
                    "18": [
                        { id: 123, name: "Monaragala", district_id: 18 },
                        { id: 124, name: "Wellawaya", district_id: 18 },
                        { id: 125, name: "Bibile", district_id: 18 },
                        { id: 126, name: "Buttala", district_id: 18 },
                        { id: 127, name: "Kataragama", district_id: 18 },
                        { id: 128, name: "Medagama", district_id: 18 },
                        { id: 129, name: "Siyambalanduwa", district_id: 18 }
                    ],
                    "19": [
                        { id: 130, name: "Mullaitivu", district_id: 19 },
                        { id: 131, name: "Oddusuddan", district_id: 19 },
                        { id: 132, name: "Puthukudiyiruppu", district_id: 19 },
                        { id: 133, name: "Weli Oya", district_id: 19 },
                        { id: 134, name: "Kokkilai", district_id: 19 },
                        { id: 135, name: "Mankulam", district_id: 19 }
                    ],
                    "20": [
                        { id: 136, name: "Nuwara Eliya", district_id: 20 },
                        { id: 137, name: "Hatton", district_id: 20 },
                        { id: 138, name: "Talawakele", district_id: 20 },
                        { id: 139, name: "Ginigathena", district_id: 20 },
                        { id: 140, name: "Ramboda", district_id: 20 },
                        { id: 141, name: "Walapane", district_id: 20 },
                        { id: 142, name: "Kotagala", district_id: 20 }
                    ],
                    "21": [
                        { id: 143, name: "Polonnaruwa", district_id: 21 },
                        { id: 144, name: "Kaduruwela", district_id: 21 },
                        { id: 145, name: "Medirigiriya", district_id: 21 },
                        { id: 146, name: "Hingurakgoda", district_id: 21 },
                        { id: 147, name: "Dimbulagala", district_id: 21 },
                        { id: 148, name: "Manampitiya", district_id: 21 }
                    ],
                    "22": [
                        { id: 149, name: "Puttalam", district_id: 22 },
                        { id: 150, name: "Chilaw", district_id: 22 },
                        { id: 151, name: "Wennappuwa", district_id: 22 },
                        { id: 152, name: "Anamaduwa", district_id: 22 },
                        { id: 153, name: "Nattandiya", district_id: 22 },
                        { id: 154, name: "Dankotuwa", district_id: 22 },
                        { id: 155, name: "Marawila", district_id: 22 }
                    ],
                    "23": [
                        { id: 156, name: "Ratnapura", district_id: 23 },
                        { id: 157, name: "Embilipitiya", district_id: 23 },
                        { id: 158, name: "Balangoda", district_id: 23 },
                        { id: 159, name: "Pelmadulla", district_id: 23 },
                        { id: 160, name: "Kahawatta", district_id: 23 },
                        { id: 161, name: "Kuruwita", district_id: 23 },
                        { id: 162, name: "Eheliyagoda", district_id: 23 }
                    ],
                    "24": [
                        { id: 163, name: "Trincomalee", district_id: 24 },
                        { id: 164, name: "Kinniya", district_id: 24 },
                        { id: 165, name: "Mutur", district_id: 24 },
                        { id: 166, name: "Kuchchaveli", district_id: 24 },
                        { id: 167, name: "Nilaveli", district_id: 24 },
                        { id: 168, name: "Uppuveli", district_id: 24 },
                        { id: 169, name: "Kantale", district_id: 24 }
                    ],
                    "25": [
                        { id: 170, name: "Vavuniya", district_id: 25 },
                        { id: 171, name: "Cheddikulam", district_id: 25 },
                        { id: 172, name: "Nedunkeni", district_id: 25 },
                        { id: 173, name: "Settikulam", district_id: 25 },
                        { id: 174, name: "Omanthai", district_id: 25 },
                        { id: 175, name: "Vavuniya South", district_id: 25 }
                    ]
                };

                this.loaded = true;
                console.log(`✅ Loaded ${this.districts.length} districts with comprehensive city data`);
            }

            getDistricts() {
                return this.districts;
            }

            getCitiesForDistrict(districtId) {
                return this.cities[districtId.toString()] || [];
            }

            searchDistricts(query) {
                if (!query) return this.districts;
                
                query = query.toLowerCase();
                return this.districts.filter(district => 
                    district.name.toLowerCase().includes(query) ||
                    district.province.toLowerCase().includes(query)
                );
            }

            searchCities(districtId, query) {
                const cities = this.getCitiesForDistrict(districtId);
                if (!query) return cities;
                
                query = query.toLowerCase();
                return cities.filter(city => 
                    city.name.toLowerCase().includes(query)
                );
            }
        }

        // Enhanced Searchable Dropdown Class
        class SearchableDropdown {
            constructor(containerId, options = {}) {
                this.container = document.getElementById(containerId);
                this.input = this.container.querySelector('.searchable-input');
                this.hiddenInput = this.container.querySelector('input[type="hidden"]');
                this.optionsContainer = this.container.querySelector('.dropdown-options');
                
                this.dataLoader = options.dataLoader;
                this.onSelect = options.onSelect || (() => {});
                this.isOpen = false;
                this.selectedValue = null;
                this.highlightedIndex = -1;
                this.currentData = [];
                
                this.init();
            }

            init() {
                this.input.addEventListener('input', (e) => this.handleInput(e));
                this.input.addEventListener('focus', () => this.open());
                this.input.addEventListener('keydown', (e) => this.handleKeydown(e));
                
                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!this.container.contains(e.target)) {
                        this.close();
                   }
               });
           }

           setData(data) {
               this.currentData = data;
               this.renderOptions();
           }

           handleInput(e) {
               const query = e.target.value.toLowerCase().trim();
               this.filterAndRender(query);
               this.open();
           }

           filterAndRender(query = '') {
               // This will be implemented by subclasses
               this.highlightedIndex = -1;
               this.renderOptions();
           }

           handleKeydown(e) {
               if (!this.isOpen) return;

               const options = this.optionsContainer.querySelectorAll('.dropdown-option:not(.no-results)');
               
               switch(e.key) {
                   case 'ArrowDown':
                       e.preventDefault();
                       this.highlightedIndex = Math.min(this.highlightedIndex + 1, options.length - 1);
                       this.updateHighlight();
                       break;
                   case 'ArrowUp':
                       e.preventDefault();
                       this.highlightedIndex = Math.max(this.highlightedIndex - 1, 0);
                       this.updateHighlight();
                       break;
                   case 'Enter':
                       e.preventDefault();
                       if (this.highlightedIndex >= 0 && options[this.highlightedIndex]) {
                           this.selectOption(options[this.highlightedIndex]);
                       }
                       break;
                   case 'Escape':
                       this.close();
                       break;
               }
           }

           updateHighlight() {
               const options = this.optionsContainer.querySelectorAll('.dropdown-option:not(.no-results)');
               options.forEach((option, index) => {
                   option.classList.toggle('highlighted', index === this.highlightedIndex);
               });

               if (this.highlightedIndex >= 0 && options[this.highlightedIndex]) {
                   options[this.highlightedIndex].scrollIntoView({ block: 'nearest' });
               }
           }

           renderOptions() {
               if (this.currentData.length === 0) {
                   this.optionsContainer.innerHTML = '<div class="no-results">No results found</div>';
                   return;
               }

               this.optionsContainer.innerHTML = this.currentData.map(item => {
                   const isSelected = this.selectedValue && this.selectedValue.id === item.id;
                   return `
                       <div class="dropdown-option ${isSelected ? 'selected' : ''}" 
                            data-id="${item.id}" data-name="${item.name}" data-obj='${JSON.stringify(item)}'>
                           <div class="option-main">${item.name}</div>
                           ${item.province ? `<div class="option-sub">${item.province} Province</div>` : ''}
                       </div>
                   `;
               }).join('');

               this.optionsContainer.querySelectorAll('.dropdown-option').forEach(option => {
                   option.addEventListener('click', () => this.selectOption(option));
               });
           }

           selectOption(option) {
               const data = JSON.parse(option.getAttribute('data-obj'));
               
               this.selectedValue = data;
               this.input.value = data.name;
               this.hiddenInput.value = data.name.toLowerCase().replace(/\s+/g, '-');
               
               this.optionsContainer.querySelectorAll('.dropdown-option').forEach(opt => {
                   opt.classList.remove('selected');
               });
               option.classList.add('selected');
               
               this.close();
               this.onSelect(this.selectedValue);
               
               this.hiddenInput.dispatchEvent(new Event('change'));
           }

           open() {
               if (this.input.disabled) return;
               
               this.isOpen = true;
               this.container.classList.add('active');
               this.input.style.borderRadius = '8px 8px 0 0';
           }

           close() {
               this.isOpen = false;
               this.container.classList.remove('active');
               this.input.style.borderRadius = '8px';
               this.highlightedIndex = -1;
           }

           reset() {
               this.selectedValue = null;
               this.input.value = '';
               this.hiddenInput.value = '';
               this.currentData = [];
               this.close();
           }

           disable() {
               this.input.disabled = true;
               this.input.placeholder = 'First select a district...';
               this.reset();
           }

           enable(placeholder = 'Search or select...') {
               this.input.disabled = false;
               this.input.placeholder = placeholder;
           }
       }

       // District Dropdown
       class DistrictDropdown extends SearchableDropdown {
           filterAndRender(query = '') {
               const filteredDistricts = this.dataLoader.searchDistricts(query);
               this.setData(filteredDistricts);
           }

           async initialize() {
               await this.dataLoader.loadData();
               this.filterAndRender();
           }
       }

       // City Dropdown
       class CityDropdown extends SearchableDropdown {
           constructor(containerId, options) {
               super(containerId, options);
               this.selectedDistrictId = null;
           }

           setDistrict(districtId) {
               this.selectedDistrictId = districtId;
               this.reset();
               this.filterAndRender();
           }

           filterAndRender(query = '') {
               if (!this.selectedDistrictId) {
                   this.setData([]);
                   return;
               }

               const filteredCities = this.dataLoader.searchCities(this.selectedDistrictId, query);
               this.setData(filteredCities);
           }
       }

       // Initialize location dropdowns when DOM loads
       document.addEventListener('DOMContentLoaded', async function() {
           const dataLoader = new LocationDataLoader();
           
           try {
               // Initialize district dropdown
               const districtDropdown = new DistrictDropdown('district-dropdown', {
                   dataLoader: dataLoader,
                   onSelect: (district) => {
                       console.log('Selected district:', district);
                       
                       // Enable and update city dropdown
                       cityDropdown.enable('Search or select city...');
                       cityDropdown.setDistrict(district.id);
                   }
               });

               // Initialize city dropdown
               const cityDropdown = new CityDropdown('city-dropdown', {
                   dataLoader: dataLoader,
                   onSelect: (city) => {
                       console.log('Selected city:', city);
                   }
               });

               // Load data and initialize districts
               await districtDropdown.initialize();
               cityDropdown.disable();

               // Store globally for debugging
               window.districtDropdown = districtDropdown;
               window.cityDropdown = cityDropdown;
               window.locationData = dataLoader;

               console.log('🎉 Location dropdowns initialized successfully!');

           } catch (error) {
               console.error('❌ Failed to initialize location dropdowns:', error);
           }
       });

    </script>
</body>
</html>